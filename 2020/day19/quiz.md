# 19日目：魔物の報告 #

あなたは鬱蒼とした森に囲まれた空港に着陸しました。
高速列車に向かって歩いていると、神話情報局の妖精から再び連絡がありました。
彼らは自分たちの衛星が**海の怪物**の画像を集めたと思っています！
残念ながら、衛星への接続に問題があり、衛星から返送されたメッセージの多くが破損しています。

彼らは、**有効なメッセージが従うべき規則**のリストと、
これまでに収集した**受信メッセージ**のリスト（パズルの入力）を送ってきました。

**有効なメッセージ**の規則（パズル入力の上部）には番号が付けられ、相互に構築されています。
例えば：

~~~
0: 1 2
1: "a"
2: 1 3 | 3 1
3: "b"
~~~

`3: "b"`のような規則は、単純に1文字（この場合は`b`）に照合します。

その他の規則には、従う必要のある下位規則が列挙されています。
たとえば、規則`0: 1 2`は、規則`0`に照合するためには、
照合される文字列は規則1に照合する必要があり、
さらに規則1に照合した部分の後の文字列が規則2に照合する必要があることを意味します。

一部の規則には、縦棒文字(`|`)で区切られた下位規則の複数のリストがあります。
これは、下位規則の**少なくとも1つ**のリストが照合する必要があることを意味します。
（照合する下位規則は、規則に遭遇するたびに異なる場合があります。）
たとえば、規則`2: 1 3 | 3 1`は、規則2に照合するためには、
照合される文字列は規則1に照合しその続きが規則3に照合するか**または**、
規則3に照合しその続きが規則1に照合する必要があることを意味します。

幸い、規則には循環がないため、照合する文字列のリストは有限です。
規則1が`a`と照合し規則3が`b`と照合するため、
規則2は`ab`または`ba`のどちらとも照合します。
したがって、規則0は`aab`または`aba`と照合します。

より興味深い例を次に示します。

~~~
0: 4 1 5
1: 2 3 | 3 2
2: 4 4 | 5 5
3: 4 5 | 5 4
4: "a"
5: "b"
~~~

ここでは、規則4が`a`と照合し、規則5が`b`と照合するため、
規則2は同じ2つの文字（`aa`または`bb`）と照合し、
規則3は異なる2つの文字（`ab`または`ba`）と照合します。

規則1は規則2および規則3と一度ずつ任意の順序で照合するため、
これは二つの文字の対、片方は同じ文字の対、もう一方は異なる文字の対、と照合します。
これは8つの可能性`aaab`, `aaba`, `bbab`, `bbba`, `abaa`, `abbb`, `baaa`, `babb`を残します。

よって、規則0は、`a`（規則4）、
続いて規則1の8つの選択肢の任意のいずれか、
そして`b`（規則5）と照合します。
`aaaabb`, `aaabab`, `abbabb`, `abbbab`, `aabaab`, `aabbbb`, `abaaab`, `ababbb`

**受信したメッセージ**（あなたのパズル入力の下の部分）は、
どれが有効でありどれが破損しているかを決定することができるように、
規則に照らして検査する必要があります。
規則とメッセージを合わせると、次のようになります。

~~~
0: 4 1 5
1: 2 3 | 3 2
2: 4 4 | 5 5
3: 4 5 | 5 4
4: "a"
5: "b"

ababbb
bababa
abbbab
aaabbb
aaaabbb
~~~

あなたの目標は、規則0に完全に照合するメッセージの個数を決定することです。
上記の例では、`ababbb`と`abbbab`は照合し、
`bababa`, `aaabbb`, `aaaabbb`はしないため、答えは2となります。
メッセージ全体が規則0の全体と照合する必要があります。
メッセージに照合しない文字が残ってはいけません。
（たとえば、`aaaabbb`は上記の規則0に一致しているように見えるかもしれませんが、
末尾に照合しない余計な`b`があります。）

規則0に完全に一致するメッセージはいくつありますか？

# パート2 #

メッセージのリストを眺めると、照合規則が完全に正しいというわけではないことがわかります。
それらを修正するには、規則`8: 42`と`11: 42 31`を以下と完全に置き換えます。

~~~
8: 42 | 42 8
11: 42 31 | 42 11 31
~~~

この小さな変更は大きな影響を及ぼします。
今や、規則には循環が含まれており、
照合する可能性のあるメッセージのリストは無限です。
これらの変更がどのメッセージが有効であるかにどのように影響するかを判断する必要があります。

幸い、規則の多くはこの変更の影響を受けません。
どの規則が常に同じ値の集合と照合するのか、
そして**それら**の規則（特に規則42と31）が
規則8と規則11の新しい版でどのように使われているかを
確認することから始めると役立つかもしれません。

**自分が持っている規則だけを扱うだけでよい**ことを忘れないでください。
任意の規則の組み合わせを扱える解の構築は、はるかに困難です。（形式言語理論の話題）

例えば：

~~~
42: 9 14 | 10 1
9: 14 27 | 1 26
10: 23 14 | 28 1
1: "a"
11: 42 31
5: 1 14 | 15 1
19: 14 1 | 14 14
12: 24 14 | 19 1
16: 15 1 | 14 14
31: 14 17 | 1 13
6: 14 14 | 1 14
2: 1 24 | 14 4
0: 8 11
13: 14 3 | 1 12
15: 1 | 14
17: 14 2 | 1 7
23: 25 1 | 22 14
28: 16 1
4: 1 1
20: 14 14 | 1 15
3: 5 14 | 16 1
27: 1 6 | 14 18
14: "b"
21: 14 1 | 1 14
25: 1 1 | 1 14
22: 14 14
8: 42
26: 14 22 | 1 20
18: 15 15
7: 14 5 | 1 21
24: 14 1

abbbbbabbbaaaababbaabbbbabababbbabbbbbbabaaaa
bbabbbbaabaabba
babbbbaabbbbbabbbbbbaabaaabaaa
aaabbbbbbaaaabaababaabababbabaaabbababababaaa
bbbbbbbaaaabbbbaaabbabaaa
bbbababbbbaaaaaaaabbababaaababaabab
ababaaaaaabaaab
ababaaaaabbbaba
baabbaaaabbaaaababbaababb
abbbbabbbbaaaababbbbbbaaaababb
aaaaabbaabaaaaababaa
aaaabbaaaabbaaa
aaaabbaabbaaaaaaabbbabbbaaabbaabaaa
babaaabbbaaabaababbaabababaaab
aabbbbbaabbbaaaaaabbbbbababaaaaabbaaabba
~~~

規則8と11を更新しないままでは、これらの規則は
の3つのメッセージ`bbabbbbaabaabba`, `ababaaaaaabaaab`, `ababaaaaabbbaba`
だけと照合します。

しかし、規則8と11を更新した後では、合計12メッセージと照合します。

- `bbabbbbaabaabba`
- `babbbbaabbbbbabbbbbbaabaaabaaa`
- `aaabbbbbbaaaabaababaabababbabaaabbababababaaa`
- `bbbbbbbaaaabbbbaaabbabaaa`
- `bbbababbbbaaaaaaaabbababaaababaabab`
- `ababaaaaaabaaab`
- `ababaaaaabbbaba`
- `baabbaaaabbaaaababbaababb`
- `abbbbabbbbaaaababbbbbbaaaababb`
- `aaaaabbaabaaaaababaa`
- `aaaabbaabbaaaaaaabbbabbbaaabbaabaaa`
- `aabbbbbaabbbaaaaaabbbbbababaaaaabbaaabba`

**規則8と11を更新した後、規則0に完全に一致するメッセージはいくつありますか？**
