# 20日目：海の怪物のジグソーパズル #

高速列車は森を抜けて、凄い速度で南に向かいます。
遠くに砂漠も見えます！
暇な時間があるので、神話情報局の衛星が撮影した画像に
何か面白いものがあったかどうかを確認したほうがいいかもしれません。

衛星メッセージを復号すると、データは実際には衛星の**カメラアレイ**によって作成された
多くの小さな画像が含まれていることがわかりました。
カメラアレイは多くのカメラで構成されています。
単一の正方形の画像を生成するのではなく、
**単一の画像に再構成する**必要がある多くの小さな正方形の画像**タイル**を
個々のカメラが生成します。

カメラアレイ内の各カメラは、ランダムで一意の**ID番号**の付いた単一のモノクロ**画像タイル**を返します。
タイル（パズル入力）はランダムな順序で到着しました。

さらに悪いことに、カメラアレイが誤動作しているように見えます。
各画像タイルは**ランダムな向きに回転し反転**しています。
あなたの最初の仕事は、それぞれのタイルが
合わさるように向きと位置を合わせて配置することにより、
元の画像を再構築することです。

タイルを再構築する方法を示すために、各タイルの画像データには、
隣接するタイルとちょうど一致する縁が含まれています。
すべてのタイルにこの縁があり、タイルの向きが正しい場合、境界線はぴったり一致します。
画像の端のタイルにもこの縁がありますが、最外端は他のタイルと揃いません。

たとえば、次の9つのタイルがあるとします。

~~~
Tile 2311:
..##.#..#.
##..#.....
#...##..#.
####.#...#
##.##.###.
##...#.###
.#.#.#..##
..#....#..
###...#.#.
..###..###

Tile 1951:
#.##...##.
#.####...#
.....#..##
#...######
.##.#....#
.###.#####
###.##.##.
.###....#.
..#.#..#.#
#...##.#..

Tile 1171:
####...##.
#..##.#..#
##.#..#.#.
.###.####.
..###.####
.##....##.
.#...####.
#.##.####.
####..#...
.....##...

Tile 1427:
###.##.#..
.#..#.##..
.#.##.#..#
#.#.#.##.#
....#...##
...##..##.
...#.#####
.#.####.#.
..#..###.#
..##.#..#.

Tile 1489:
##.#.#....
..##...#..
.##..##...
..#...#...
#####...#.
#..#.#.#.#
...#.#.#..
##.#...##.
..##.##.##
###.##.#..

Tile 2473:
#....####.
#..#.##...
#.##..#...
######.#.#
.#...#.#.#
.#########
.###.#..#.
########.#
##...##.#.
..###.#.#.

Tile 2971:
..#.#....#
#...###...
#.#.###...
##.##..#..
.#####..##
.#..####.#
#..#.#..#.
..####.###
..#.#.###.
...#.#.#.#

Tile 2729:
...#.#.#.#
####.#....
..#.#.....
....#..#.#
.##..##.#.
.#.####...
####.#.#..
##.####...
##..#.##..
#.##...##.

Tile 3079:
#.#.#####.
.#..######
..#.......
######....
####.#..#.
.#...#.##.
#.#####.##
..#.###...
..#.......
..#.###...
~~~

これらを回転、反転、および再配置することにより、
隣接するすべての境界線を一致させる正方形の配置を見つけることができます。

~~~
#...##.#.. ..###..### #.#.#####.
..#.#..#.# ###...#.#. .#..######
.###....#. ..#....#.. ..#.......
###.##.##. .#.#.#..## ######....
.###.##### ##...#.### ####.#..#.
.##.#....# ##.##.###. .#...#.##.
#...###### ####.#...# #.#####.##
.....#..## #...##..#. ..#.###...
#.####...# ##..#..... ..#.......
#.##...##. ..##.#..#. ..#.###...

#.##...##. ..##.#..#. ..#.###...
##..#.##.. ..#..###.# ##.##....#
##.####... .#.####.#. ..#.###..#
####.#.#.. ...#.##### ###.#..###
.#.####... ...##..##. .######.##
.##..##.#. ....#...## #.#.#.#...
....#..#.# #.#.#.##.# #.###.###.
..#.#..... .#.##.#..# #.###.##..
####.#.... .#..#.##.. .######...
...#.#.#.# ###.##.#.. .##...####

...#.#.#.# ###.##.#.. .##...####
..#.#.###. ..##.##.## #..#.##..#
..####.### ##.#...##. .#.#..#.##
#..#.#..#. ...#.#.#.. .####.###.
.#..####.# #..#.#.#.# ####.###..
.#####..## #####...#. .##....##.
##.##..#.. ..#...#... .####...#.
#.#.###... .##..##... .####.##.#
#...###... ..##...#.. ...#..####
..#.#....# ##.#.#.... ...##.....
~~~

参考までに、上記のタイルのIDは次のとおりです。

~~~
1951    2311    3079
2729    1427    2473
2971    1489    1171
~~~

画像が正しく再構築されていることを確認するには、四隅のタイルのIDを掛け合わせます。
上記の例で構築されたタイルに対してこれを行うと、1951 * 3079 * 2971 * 1171 = 20899048083289が得られます。

タイルを画像に組み立てます。
**四隅のタイルのIDを掛け合わせるといくつになりますか？**

# パート2 #

これで、**画像から海の怪物を探す**準備が整いました。

各タイルの縁は実際の画像の一部ではありません。それらを削除することから始めます。

上記の例では、タイルは次のようになります。

~~~
.#.#..#. ##...#.# #..#####
###....# .#....#. .#......
##.##.## #.#.#..# #####...
###.#### #...#.## ###.#..#
##.#.... #.##.### #...#.##
...##### ###.#... .#####.#
....#..# ...##..# .#.###..
.####... #..#.... .#......

#..#.##. .#..###. #.##....
#.####.. #.####.# .#.###..
###.#.#. ..#.#### ##.#..##
#.####.. ..##..## ######.#
##..##.# ...#...# .#.#.#..
...#..#. .#.#.##. .###.###
.#.#.... #.##.#.. .###.##.
###.#... #..#.##. ######..

.#.#.### .##.##.# ..#.##..
.####.## #.#...## #.#..#.#
..#.#..# ..#.#.#. ####.###
#..####. ..#.#.#. ###.###.
#####..# ####...# ##....##
#.##..#. .#...#.. ####...#
.#.###.. ##..##.. ####.##.
...###.. .##...#. ..#..###
~~~

隙間をなくして実際の画像を作成します。

~~~
.#.#..#.##...#.##..#####
###....#.#....#..#......
##.##.###.#.#..######...
###.#####...#.#####.#..#
##.#....#.##.####...#.##
...########.#....#####.#
....#..#...##..#.#.###..
.####...#..#.....#......
#..#.##..#..###.#.##....
#.####..#.####.#.#.###..
###.#.#...#.######.#..##
#.####....##..########.#
##..##.#...#...#.#.#.#..
...#..#..#.#.##..###.###
.#.#....#.##.#...###.##.
###.#...#..#.##.######..
.#.#.###.##.##.#..#.##..
.####.###.#...###.#..#.#
..#.#..#..#.#.#.####.###
#..####...#.#.#.###.###.
#####..#####...###....##
#.##..#..#...#..####...#
.#.###..##..##..####.##.
...###...##...#...#..###
~~~

これで、海の怪物を探す準備ができました！
画像がモノクロなので、海の怪物は次のように見えます。

~~~
                  # 
#    ##    ##    ###
 #  #  #  #  #  #   
~~~

画像からこのパターンを探す場合、**空白文字は何でもかまいません**。
`#`だけが一致する必要があります。
また、海の怪物を見つけるために画像を正しい向きにするために、
画像を回転または反転する必要がある場合があるかもしれません。
上の画像では、適切な方向に**反転して回転させた後**、
海の怪物が２匹（`O`で印されているO）があります。

~~~
.####...#####..#...###..
#####..#..#.#.####..#.#.
.#.#...#.###...#.##.O#..
#.O.##.OO#.#.OO.##.OOO##
..#O.#O#.O##O..O.#O##.##
...#.#..##.##...#..#..##
#.##.#..#.#..#..##.#.#..
.###.##.....#...###.#...
#.####.#.#....##.#..#.#.
##...#..#....#..#...####
..#.##...###..#.#####..#
....#.##.#.#####....#...
..##.##.###.....#.##..#.
#...#...###..####....##.
.#.##...#.##.#.#.###...#
#.###.#..####...##..#...
#.###...#.##...#.##O###.
.O##.#OO.###OO##..OOO##.
..O#.O..O..O.#O##O##.###
#.#..##.########..#..##.
#.#####..#.#...##..#....
#....##..#.#########..##
#...#.....#..##...###.##
#..###....##.#...##.##.#
~~~

海の怪物の一部では**ない**`#`の数を数えることによって、
海の怪物の生息地の波がどれほど荒いかを判断します。
上記の例では、生息地の波の荒さは273です。

**海の怪物の一部ではない`#`はいくつありますか？**
