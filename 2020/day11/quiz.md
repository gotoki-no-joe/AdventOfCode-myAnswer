# 11日目：座席システム #

あなたの飛行機は余裕を持って着陸しました。
あなたの旅の最後の行程は、あなたが最終的にあなたの休暇を始めることができる熱帯の島に直接行くフェリーです。
フェリーに乗るために待合室に着くと、あなたはとても早いことに気づきます。他の誰もまだ到着していません！

人々が待合室で自分の席を選ぶ（または明け渡す）ために使用するプロセスをモデル化することにより、
あなたは座るのに最適な場所を予測できると確信しています。
座席の配置を手早くまとめた地図を作成しました（パズル入力）。

座席の配置は格子にぴったりと収まります。
各位置は、床（`.`）、空席（`L`）、使用中（`#`）のいずれかです。
最初の座席レイアウトはたとえば次のようになります。

~~~
L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL
~~~

今、あなたはまもなく到着する人々をモデル化する必要があります。
幸いなことに、人々は完全に予測可能であり、常に単純な一連の規則に従います。
すべての判断は、その座席に隣接（座席のすぐ上、下、左、右、または斜めの8つの位置）する
**使用中の席の数**に基づきます。
次の規則がすべての座席に同時に適用されます。

- 座席が**空席**（`L`）で、隣接する使用中の席が**ない**場合、誰かがそこに**座ります**。
- 座席が**座られている**（`#`）場合、それに隣接する**4つ以上**の座席も使用中の場合、その人は**席を空けます**。
- それ以外の場合、席の状態は変わりません。

床（`.`）は決して変化しません。座席は動かせず、誰も床に座りません。

これらの規則を1回実行すると、配置例のすべての席が使用中になります。

~~~
#.##.##.##
#######.##
#.#.#..#..
####.##.##
#.##.##.##
#.#####.##
..#.#.....
##########
#.######.#
#.#####.##
~~~

2回目の実行の後、隣接する4つ以上の座席が使用中の席は再び空席になります。

~~~
#.LL.L#.##
#LLLLLL.L#
L.L.L..L..
#LLL.LL.L#
#.LL.LL.LL
#.LLLL#.##
..L.L.....
#LLLLLLLL#
#.LLLLLL.L
#.#LLLL.##
~~~

この手順をさらに3回続けます。

~~~
#.##.L#.##
#L###LL.L#
L.#.#..#..
#L##.##.L#
#.##.LL.LL
#.###L#.##
..#.#.....
#L######L#
#.LL###L.L
#.#L###.##
~~~

~~~
#.#L.L#.##
#LLL#LL.L#
L.L.L..#..
#LLL.##.L#
#.LL.LL.LL
#.LL#L#.##
..L.L.....
#L#LLLL#L#
#.LLLLLL.L
#.#L#L#.##
~~~

~~~
#.#L.L#.##
#LLL#LL.L#
L.#.L..#..
#L##.##.L#
#.#L.LL.LL
#.#L#L#.##
..L.L.....
#L#L##L#L#
#.LLLLLL.L
#.#L#L#.##
~~~

この時点で、興味深いことが起こります。
混沌が安定し、これらの規則をさらに適用しても、座席の状態が変わることはありません。
人々が動き回るのをやめたところで、使用中の席を数えると37です。

座席の状態が変化しなくなるまで着席規則を繰り返し適用して、座席エリアをシミュレートします。
**最終的にいくつの席が使用中ですか？**

# パート2 #

人々が到着し始めるとすぐに、あなたは自分の間違いに気づきます。
人々は隣接する座席だけを気にするのではなく、
それらの8つの方向のそれぞれに**見える最初の座席**を気にします！

隣接する8つの座席だけを考慮するのではなく、
これらの8つの方向のそれぞれの**最初の座席**を考慮します。
たとえば、下の空いている席からは、**8つ**の使用中の席が見えます。

~~~
.......#.
...#.....
.#.......
.........
..#L....#
....#....
.........
#........
...#.....
~~~

下の左端の空席からは空席**1つ**だけが見えて、使用中の席は見えません。

~~~
.............
.L.L.#.#.#.#.
.............
~~~

下の空席からは、使用中の席はひとつも見えません。

~~~
.##.##.
#.#.#.#
##...##
...L...
##...##
#.#.#.#
.##.##.
~~~

また、人々はあなたが予想したよりも寛容であるように思われます。
使用中の席が空席になるのには**5つ以上**の目に見える使用中の席が必要です。
（以前の規則の**4つ以上**から変わりました。）
他の規則は引き続き適用されます。使用中の席が見えない空席は座られ、
適合する規則のない席は変化せず、床は変化しません。

上記と同じ開始レイアウトを考えると、これらの新しい規則により、座席エリアは次のように変化します。

~~~
L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL
~~~

~~~
#.##.##.##
#######.##
#.#.#..#..
####.##.##
#.##.##.##
#.#####.##
..#.#.....
##########
#.######.#
#.#####.##
```

```
#.LL.LL.L#
#LLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLL#
#.LLLLLL.L
#.LLLLL.L#
~~~

~~~
#.L#.##.L#
#L#####.LL
L.#.#..#..
##L#.##.##
#.##.#L.##
#.#####.#L
..#.#.....
LLL####LL#
#.L#####.L
#.L####.L#
~~~

~~~
#.L#.L#.L#
#LLLLLL.LL
L.L.L..#..
##LL.LL.L#
L.LL.LL.L#
#.LLLLL.LL
..L.L.....
LLLLLLLLL#
#.LLLLL#.L
#.L#LL#.L#
~~~

~~~
#.L#.L#.L#
#LLLLLL.LL
L.L.L..#..
##L#.#L.L#
L.L#.#L.L#
#.L####.LL
..#.#.....
LLL###LLL#
#.LLLLL#.L
#.L#LL#.L#
~~~

~~~
#.L#.L#.L#
#LLLLLL.LL
L.L.L..#..
##L#.#L.L#
L.L#.LL.L#
#.LLLL#.LL
..#.L.....
LLL###LLL#
#.LLLLL#.L
#.L#LL#.L#
~~~

今回も、この時点で人々は動き回るのをやめ、座席エリアは平衡に達します。
こうなったとき、使用中の席を数えると26あります。

新しい見え方の方法と使用中の席が空席になる規則の変更により、
平衡に達したとき、**最終的に使用中の席はいくつになりますか？**
