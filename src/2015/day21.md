# 21日目：RPGシミュレータ20XX

Little Henry Caseがクリスマス用の新しいビデオゲームを手に入れました。
それはRPGです、そして、彼はボスで立ち往生しています。
彼は店でどんな装備を買うべきかを知る必要があります。
彼はあなたにコントローラーを渡します。

このゲームでは、プレイヤー（あなた）と敵（ボス）が交互に攻撃します。
常にプレイヤーが最初に行動します。
各攻撃は相手のヒットポイントを少なくとも1減少させます。
先にヒットポイント0以下になったキャラクターが負けます。

各ターンに攻撃側によって与えられるダメージは、
攻撃側のダメージスコアから防御側のアーマースコアを引いたものになります。
攻撃者は常に少なくとも1ダメージを与えます。
したがって、攻撃側のダメージスコアが8で、
防御側のアーマースコアがである3場合、
防御側は5ヒットポイントを失います。
防御側のアーマースコアが300であれば、
防御側は依然として1ヒットポイントを失います。

あなたのダメージスコアとアーマースコアは両方ともゼロから始まります。
それらは金と引き換えにアイテムを購入することで増やすことができます。
始めあなたはアイテムなしで、お金はいくらでも必要なだけ持っています。
あなたの総ダメージスコアやアーマースコアは
あなたのアイテム全てからのそれらの属性値の合計になります。
あなたは**100ヒットポイント**を持っています。

これがアイテムショップで売っているものです。

~~~
Weapons:    Cost  Damage  Armor
Dagger        8     4       0
Shortsword   10     5       0
Warhammer    25     6       0
Longsword    40     7       0
Greataxe     74     8       0

Armor:      Cost  Damage  Armor
Leather      13     0       1
Chainmail    31     0       2
Splintmail   53     0       3
Bandedmail   75     0       4
Platemail   102     0       5

Rings:      Cost  Damage  Armor
Damage +1    25     1       0
Damage +2    50     2       0
Damage +3   100     3       0
Defense +1   20     0       1
Defense +2   40     0       2
Defense +3   80     0       3
~~~

あなたは武器を一つだけ購入しなければなりません。二刀流ではありません。
防具はオプションですが、複数使用することはできません。
あなたは0～2個の指輪を購入することができます（両手にそれぞれ最大1個）。
あなたはあなたが買ったアイテムを全て使わなければなりません。
ショップには各アイテムが1つしかないので、
例えばダメージ+3の指輪を2つ買うことはできません。

たとえば、あなたは8ヒットポイント、5ダメージスコア、5アーマースコアを持ち、
ボスは12ヒットポイント、7ダメージスコア、2アーマースコアを持つとします。

- プレイヤーは \\(5-2 = 3\\) ダメージを与えます。ボスは9ヒットポイントになります。
- ボスは \\(7-5 = 2\\) ダメージを与えます。プレイヤーは6ヒットポイントになります。
- プレイヤーは \\(5-2 = 3\\) ダメージを与えます。ボスは6ヒットポイントになります。
- ボスは \\(7-5 = 2\\) ダメージを与えます。プレイヤーは4ヒットポイントになります。
- プレイヤーは \\(5-2 = 3\\) ダメージを与えます。ボスは3ヒットポイントになります。
- ボスは \\(7-5 = 2\\) ダメージを与えます。プレイヤーは2ヒットポイントになります。
- プレイヤーは \\(5-2 = 3\\) ダメージを与えます。ボスは0ヒットポイントになります。

このシナリオでは、（かろうじて）プレイヤーが勝ちます！

あなたは**100ヒットポイント**を持っています。
ボスの実際の属性値はあなたのパズルの入力にあります。
あなたが使う**最小の、それでも戦いに勝つことができる金額**はいくらですか？

<details><summary>解説</summary><div>

お買い物の全ての場合を数え上げてみる。

武器はひとつだけ選んで購入する。

```haskell
weapon <- [(8,4.0),(10,5,0),(25,6,0),(40,7,0),(74,8,0)]
```

防具はひとつだけ選んで購入するか、使わないでもよい。

```haskell
armor <- [(0,0,0),(13,0,1),(31,0,2),(53,0,3),(75,0,4),(102,0,5)]
```

指輪は二つまで使える。

```haskell
rings = [(25,1,0),(50,2,0),(100,3,0),(20,0,1),(40,0,2),(80,0,3),(0,0,0)]
(ring1:rs) <- tails rings
ring2 <- if null rs then [ring1] else rs
```

総当たりの組み合わせを、費用の安い順にする。

```haskell
cags = sort
  [ weapon `add` armor `add` ring1 `add` ring2
  | weapon <- ...]
add (a,b,c) (d,e,f) = (a+d,b+e,c+f)
```

自分のHP、攻撃力、防御力を \\(h_1 = 100, a_1, g_1\\)、
ボスのそれを \\(h_2, a_2, g_2\\) とする。

こちらの攻撃1回で削るHP量は \\(\max(1, a_1-g_2)\\) で、
ボスを倒すまでかかるターン数は \\(\lceil \frac{h_2}{\max(1, a_1 - g_2)} \rceil\\) である。

ボスからの攻撃1回で削られるHP量は \\(\max(1, a_2-g_1)\\) で、
耐えるターン数は \\(\lceil \frac{h_1}{\max(1, a_1-g_2)} \rceil\\) である。

結局、この戦いに勝つ条件は
\\(\lceil \frac{h_1}{\max(1, a_1 - g_2)} \rceil \geq \lceil \frac{h_2}{\max(1, a_1 - g_2)} \rceil\\)
となる。

```haskell
win a1 g1 = divrup h1 (max 1 (a2 - g1)) >= divrup h2 (max 1 (a1 - g2))

h2 = ...
a2 = ...
g2 = ... -- 入力データ

part1 = head $ filter (\(_,a1,g1) -> win a1 g1) cags
```

</div></details>

# パート2

店主がボスと通じていることが判明しました。
店主はそうしたいものを何でも、あなたに買うように説得することができます。
他の規則はまだ適用され、彼はやはり各アイテムを1つずつしか持っていません。

あなたが使う**最大の、それでも戦いに負けることになる金額**はいくらですか？

<details><summary>解説</summary><div>

つまり上の逆順に、負ける最大の金額を探せばよい。

```haskell
part2 = head $ filter (\(_,a1,g1) -> not $ win a1 g1) $ reverse cags
```

</div></details>
