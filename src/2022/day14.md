# 14 日目: 降り積もる砂

（原題：Regolith Reservoir）

遭難信号があなたを巨大な滝へと導きます！
実際、ちょっと待ってください。信号は滝そのものから来ているように見えますが、そんなはずはありません。
ただし、滝の**後ろ**に続く小道に気付きます。

訂正：救難信号があなたを巨大な滝の後ろに導きます！
ここには大規模な洞窟系があるようで、信号は間違いなく奥へと誘っています。

地下深くへと進み始めると、一瞬地面が揺れるのを感じます。
砂が洞窟に流れ込み始めます！
砂の行き先を即座に把握しないと、あっという間に閉じ込められてしまうでしょう。

幸いなことに、落下する物質の経路を分析することに慣れている([2018/17])経験がここで役に立ちます。
あなたの頭上に広がっている洞窟の、垂直な2次元断面をスキャンすると（パズル入力）、
ほとんどが**空洞**で、**岩**でできた構造物があることがわかりました。

スキャンは、硬い岩でできた構造の経路をなぞり、経路の形状を形成するx,y座標列を報告します。
ここで`x`は右方向の距離を表し、`y`は下方向の距離を表します。
スキャンにおいて、ひとつの経路が1行のテキストとして示されています。
各経路の最初の座標の後、各座標は、前の座標から引かれる水平または垂直の直線の終点を示します。
例を示します：

```
498,4 -> 498,6 -> 496,6
503,4 -> 502,4 -> 502,9 -> 494,9
```

このスキャンは、岩の経路が2つあることを意味します。
最初の経路は2つの直線で構成され、2番目の経路は3つの直線で構成されます。
（具体的には、最初の経路は498,4から498,6の岩の列と、498,6から496,6の別の岩の列で構成されます。）

座標500,0から砂が洞窟に流れ込んでいます。

岩を`#`、空気を`.`、砂の噴出口を`+`で描くと、次のようになります。

```

  4     5  5
  9     0  0
  4     0  3
0 ......+...
1 ..........
2 ..........
3 ..........
4 ....#...##
5 ....#...#.
6 ..###...#.
7 ........#.
8 ........#.
9 #########.
```

砂は**一度に1単位ずつ**生成され、次の砂の単位は、前の砂の単位が**停止する**まで生成されません。
1単位の砂は、あなたのスキャンにおいて1マス分の空洞を埋めるのに十分な大きさです。

1単位の砂は、可能であれば常に**1段下に**落ちます。
すぐ下のマスが（岩や砂によって）塞がれている場合、その1単位の砂は代わりに**1つ左斜め下**に移動しようとします。
そのマスがふさがっている場合、砂は代わりに**1つ右斜め下**に移動しようとします。
砂は可能な限り動き続け、各ステップで下に移動しようとし、できなければ左下、次に右下に移動しようとします。
3つの可能な目的地が全て塞がっている場合、砂は**停止**し、移動しなくなります。
その時点で、次の砂の単位が噴出孔から生成されます。

従って、静止した砂を`o`と描画すると、最初の砂の単位は単にまっすぐに落ちてから停止します。

```
......+...
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
......o.#.
#########.
```

次に、2番目の砂の単位がまっすぐ下に落下し、最初の砂の上に着地してから、その左に止まります。

```
......+...
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
.....oo.#.
#########.
```

合計5単位の砂が停止した後、次のパターンが形成されます。

```
......+...
..........
..........
..........
....#...##
....#...#.
..###...#.
......o.#.
....oooo#.
#########.
```

合計 22 単位の砂の後:

```
......+...
..........
......o...
.....ooo..
....#ooo##
....#ooo#.
..###ooo#.
....oooo#.
...ooooo#.
#########.
```

最後に、砂はもう2単位だけが静止できます。

```
......+...
..........
......o...
.....ooo..
....#ooo##
...o#ooo#.
..###ooo#.
....oooo#.
.o.ooooo#.
#########.
```

上に示した砂**24**単位全てが静止すると、それ以降の全ての砂は底から流れ出し、無限の虚無に落ちます。
興味のある人のために、新しい砂が永遠に落ちる前にたどる道を`~`で以下に示します：

```
.......+...
.......~...
......~o...
.....~ooo..
....~#ooo##
...~o#ooo#.
..~###ooo#.
..~..oooo#.
.~o.ooooo#.
~#########.
~..........
~..........
~..........
```

あなたのスキャン結果を使用して、落下する砂をシミュレーションします。
**砂が下の深淵に流れ込み始める前に、何単位の砂が静止しますか？**

<!--
<details><summary>解説</summary><div>

最後の例でわかるように、構造より1マス左右に広げた範囲をシミュレーションして、
奈落に落ちた砂を観測したところで止めればよい。
停止した砂を書き込んでマップが変更されていくので、命令型の二次元配列が適している。

</div></details>
-->

# パート2

スキャンを読み間違えたことに気付きます。
スキャンの底に無限の空白はありません ー そこには床があり、あなたはその上に立っています！

床をスキャンする時間がないため、床は無限の水平線であり、
その`y`座標はあなたのスキャン内の**最大の`y`座標に2を加えた**ものであると想定します。

上の例では、最大の`y`座標は`9`であるため、床は`y=11`にあります。
（これは、スキャンに`-infinity,11 -> infinity,11`という追加の岩の経路が含まれているようなものです。）
床を追加すると、上の例は次のようになります。

```
        ...........+........
        ....................
        ....................
        ....................
        .........#...##.....
        .........#...#......
        .......###...#......
        .............#......
        .............#......
        .....#########......
        ....................
<-- etc #################### etc -->
```

安全に立っていられる場所を見つけるには、砂の単位が500,0で停止することで
噴出口を完全に塞いで、洞窟への砂の流入を止めるまでの砂の落下をシミュレーションする必要があります。
上の例では、93単位の砂が静止した後、状況は最終的に次のようになります。

```
............o............
...........ooo...........
..........ooooo..........
.........ooooooo.........
........oo#ooo##o........
.......ooo#ooo#ooo.......
......oo###ooo#oooo......
.....oooo.oooo#ooooo.....
....oooooooooo#oooooo....
...ooo#########ooooooo...
..ooooo.......ooooooooo..
#########################
```

あなたのスキャンを使用して、砂の噴出口が塞がれるまで落下する砂をシミュレーションします。
**何単位の砂が静止しますか？**

<!--
<details><summary>解説</summary><div>

やはり図からわかるように、噴出口から斜めに進んだ位置までしか砂は移動できないので、
床までの高さ分、`x=500` から±した範囲をシミュレーションすればよい。

</div></details>
-->
