# 21日目: キーパッドの謎

サンタの[トナカイ級宇宙船](../2019/day25.md)にテレポートすると、歴史学者たちはパニックに陥ります：
彼ら捜索隊の誰かが**行方不明**です。
宇宙船のコンピュータによる迅速な生命体スキャンにより、行方不明の歴史学者は、
テレポートした際に船の別の部分に到着したことが明らかになります。

そのエリアへのドアはロックされていますが、コンピュータでは開けることができません。
ドアの数字キーパッドでドアコード（あなたのパズル入力）を**物理的に入力する**ことでのみ開けることができます。

数字キーパッドは4行のボタンで構成されています：`789`, `456`, `123` そして最後に空欄の後に `0A` があります。
視覚的には、次のように配置されています：

```
+---+---+---+
| 7 | 8 | 9 |
+---+---+---+
| 4 | 5 | 6 |
+---+---+---+
| 1 | 2 | 3 |
+---+---+---+
    | 0 | A |
    +---+---+
```

残念ながら、ドアの外のエリアは現在**減圧**されており、誰もドアの近くに行くことができません。
<!--なら開けたらダメなのでは？ -->
代わりにロボットを送る必要があります。

ロボットは、船内を移動し数字キーパッドを見つけることには問題ありませんが、ボタンを押すために設計されていません：
特定のボタンを直接押すように指示することはできません。
代わりに、**方向キーパッド**で遠隔操作できるロボットアームがあります。

方向キーには2行のボタンがあります：1行目は 隙間、`^` (上) 、`A` (作動) があり、
2行目には `<` (左)、 `v` (下)、`>` (右) があります。
視覚的には、次のように配置されています：

```
    +---+---+
    | ^ | A |
+---+---+---+
| < | v | > |
+---+---+---+
```

ロボットが数字キーに到着すると、そのロボットアームは右下隅の `A` ボタンを指しています。
その後、この方向キーを使用してロボットアームを操作する必要があります：
上/下/左/右のボタンを押すと、アームがその方向にボタンひとつ分移動し、
`A` ボタンを押すとロボットが前に少し進み、ロボットアームが狙っているボタンを押します。

例えば、ロボットに数字キーで `029A` を入力させるために、方向キーで使用できる一連入力列は次のとおりです：

- `<` `A`（初期位置）から `0` にアームを移動させる
- `A` で `0` ボタンを押す
- `^A` でアームを `2` ボタンに移動させて押す
- `>^^A` でアームを `9` ボタンに移動させて押す
- `vvvA` でアームを `A` ボタンに移動させて押す

全体で、ロボットが `029A` を入力するための方向キーでのボタン押下の最短系列は3つあります：
`<A^A>^^AvvvA`, `<A^A^>^AvvvA`, `<A^A^^>AvvvA` です。

残念ながら、この方向キーリモコンがあるエリアは現在、**高レベルの放射線**を受けており、誰も近づくことができません。
代わりにロボットを送る必要があります。

ロボットが方向キーに到着すると、そのロボットアームは右上隅の `A` ボタンを指しています。
その後、**別の第二の**方向キーリモコンが使用されて、このロボットを制御します。
（最初のロボットと同じ方法ですが、こちらは数字キーではなく方向キーを打っています。）

このロボットが最初のロボットに `029A` をドアに入力するよう指示するための、
方向キーのボタン押下の可能な最短の入力系列は複数あります。
その一例は `v<<A>>^A<A>AvA<^AA>A<vAAA>^A` です。

残念ながら、この第二の方向キーリモコンがあるエリアは現在**マイナス40度**です！
別のロボットを送って、その方向キーを押す必要があります。

このロボットが第二のロボットに、第一のロボットに最終的に `029A` をドアに入力するように指示するための、
方向キーのボタンを押す最短の可能なシーケンスは多数あります。
その一例は `<vA<AA>>^AvAA<^A>A<v<A>>^AvA^A<vA>^A<v<A>^A>AAvA^A<v<A>A>^AAAvA<^A>A` です。

残念ながら、この第三の方向キーリモコンがあるエリアは現在**歴史学者でいっぱい**なので、
ロボットはそこまでたどり着くことができません。
代わりに、**あなたが**この系列を自分で入力する必要があります。

このボタン押下の系列を選択した場合、あなたの方向キー、
2台のロボットの方向キー、および数字キーで押される全てのボタンは次のとおりです：

```
<vA<AA>>^AvAA<^A>A<v<A>>^AvA^A<vA>^A<v<A>^A>AAvA^A<v<A>A>^AAAvA<^A>A
v<<A>>^A<A>AvA<^AA>A<vAAA>^A
<A^A>^^AvvvA
029A
```

まとめると、次のキーパッドがあります：

- **あなた**が使用している方向キーパッドが1つ
- **ロボット**が使用している方向キーパッドが2つ
- **ロボット**が使用している（ドアの）数字キーパッドが1つ

これらのロボットはボタンを押すために設計されていないことを覚えておくことが重要です。
特に、ロボットアームがキーパッド上にボタンが存在しない**空欄**を指している場合、
たとえ一瞬でも、ロボットは回復不可能な**パニック**に陥ります。
だから、それをしないでください。
全てのロボットは最初にキーパッドの `A` キーを指します。それがどこにあろうと。

ドアを解除するには、数値キーパッドに**5つ**のコードを入力する必要があります。例えば：

```
029A
980A
179A
456A
379A
```

これらのそれぞれについて、数値キーパッドで目的のコードを入力するために押すべき最短のボタン系列は例えば次のとおりです：

```
029A: <vA<AA>>^AvAA<^A>A<v<A>>^AvA^A<vA>^A<v<A>^A>AAvA^A<v<A>A>^AAAvA<^A>A
980A: <v<A>>^AAAvA^A<vA<AA>>^AvAA<^A>A<v<A>A>^AAAvA<^A>A<vA>^A<A>A
179A: <v<A>>^A<vA<A>>^AAvAA<^A>A<v<A>>^AAvA^A<vA>^AA<A>A<v<A>A>^AAAvA<^A>A
456A: <v<A>>^AA<vA<A>>^AAvAA<^A>A<vA>^A<A>A<vA>^A<A>A<v<A>A>^AAvA<^A>A
379A: <v<A>>^AvA^A<vA<AA>>^AAvA<^A>AAvA^A<vA>^AA<A>A<v<A>A>^AAAvA<^A>A
```

歴史学者たちは神経質になってきています。
船のコンピュータは、行方不明の歴史学者が閉じ込められているエリアが、
**巨大な電磁石**のある場所なのか**どろどろの溶岩**の中なのか覚えていません。
あなたは5つのコードそれぞれについて、必要なボタン押下の**最短の系列**を見つける必要があります。

単一のコード（例えば `029A`）の**複雑さ**は、次のふたつ値を掛け算した結果に等しいです：

- コードを数値キーパッドに入力するために、方向キーのキーパッドで入力する必要がある最短のボタン押下系列の長さ
ー `029A` の場合、これは 68 です。
- **コードの数値部分**（先頭のゼロを無視する）
ー `029A` の場合、これは29です。

上記の例では、5つのコードの複雑さは $68 \times 29$, $60 \times 980$, $68 \times 179$,
$64 \times 456$, $64 \times 379$ を計算することで求められます。
これらを合計すると126384になります。

ドアの前のロボットに各コードを入力させるために必要な最小のボタン押下回数を見つけてください。
リストにある5つのコードの複雑さの合計はいくつですか？

# パート2

行方不明の歴史学者が解放されると、歴史学者たちは探索隊のメンバーが
**もう一人**この間ずっと行方不明であることに気づきます！

迅速な生命体スキャンにより、この歴史学者も船のロックされたエリアに閉じ込められていることが明らかになります。
さまざまな危険があるため、再びロボットが派遣され、
ロボットアームを持つロボットを管理する遠隔操作キーパッドの別の連鎖が形成されます。

今回は、さらに多くのロボットが関与しています。
要約すると、以下のキーパッドがあります：

- ひとつの方向キーパッドを**あなた**が操作しています
- 25の方向キーパッドを**ロボット**が操作しています
- **ロボット**が操作している数値キーパッドがドアにあります

前と同じように、キーパッドは連鎖を形成します。
あなたの方向キーパッドがロボットを制御し、そのロボットが方向キーパッドでタイピングし、
その方向キーパッドが別のロボットを制御し、そのロボットが方向キーパッドでタイピングし…と続き、
最後は数値キーパッドでタイピングしているロボットになります。

ドアのコードは今回も同じで、ロボットの数と方向キーの数だけが変わりました。

ドアの前にいるロボットが各コードを入力するために必要なボタン押下の最小回数を見つけてください。
リストにある5つのコードの複雑さの合計はいくつですか？
