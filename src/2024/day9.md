# 9日目: ディスク断片化

ボタンをもう一度押すと、あなたは友好的な[ヨコエビ](../2021/day23.md)たちの馴染みのある廊下へ飛びました！
それぞれがどうにか自分用のミニ潜水艦を手に入れたのは良いことです。
歴史学者たちは、主任を探しに壁に直接突っ込むことで飛び去ります。

歴史学者たちが潜水艦を操縦する方法をすぐに理解した一方で、
あなたは隅でコンピュータと格闘しているヨコエビに気づきます。
彼は全てのファイルを密集させることでより連続した空き領域を作ろうとしていますが、
彼のプログラムはうまくいっていません。あなたは手伝うことを申し出ます。

彼は生成済みの**ディスクマップ**（あなたのパズル入力）を見せてくれます。例えば：

```
2333133121414131402
```

ディスクマップは、ディスク上の**ファイル**と**空き領域**の配置を表現するために密な形式を使用します。
数字は、ファイルの長さと空き領域の長さを交互に示します。

したがって、`12345` のようなディスクマップは、1ブロックのファイル、2ブロックの空き領域、
3ブロックのファイル、4ブロックの空き領域、そして5ブロックのファイルを表します。
`90909` のようなディスクマップは、間に空きがない3つの9ブロックファイルの連続を表します。

ディスク上の各ファイルには、再配置される前のファイルの出現順に基づいた**ID番号**があります。
ID 0から始まります。
したがって、ディスクマップ `12345` には、ID 0の1ブロックファイル、ID 1の3ブロックファイル、
ID 2の5ブロックファイルの3つのファイルがあります。
各ブロックに1文字を使用し、ブロックに対して数字でファイルID、`.` で空き領域を表すと、
ディスクマップ `12345` はこれらの個々のブロックを表します：

```
0..111....22222
```

上記の最初の例、`2333133121414131402` は、これらの個々のブロックを表しています：

```
00...111...2...333.44.5555.6666.777.888899
```

ヨコエビは、ディスクの終端から順に、最も左の空きブロックに`ファイルを一度に1ブロックずつ`移動したいと考えています
（ファイルブロックの間に隙間がなくなるまで）。
ディスクマップ `12345` の場合、プロセスは次のようになります：

```
0..111....22222
02.111....2222.
022111....222..
0221112...22...
02211122..2....
022111222......
```

最初の例はもう少し手順が必要です:

```
00...111...2...333.44.5555.6666.777.888899
009..111...2...333.44.5555.6666.777.88889.
0099.111...2...333.44.5555.6666.777.8888..
00998111...2...333.44.5555.6666.777.888...
009981118..2...333.44.5555.6666.777.88....
0099811188.2...333.44.5555.6666.777.8.....
009981118882...333.44.5555.6666.777.......
0099811188827..333.44.5555.6666.77........
00998111888277.333.44.5555.6666.7.........
009981118882777333.44.5555.6666...........
009981118882777333644.5555.666............
00998111888277733364465555.66.............
0099811188827773336446555566..............
```

このファイル密集化プロセスの最終ステップは、**ファイルシステムのチェックサム**を更新することです。
チェックサムを計算するには、これらのブロックの位置を、それが含むファイルID番号で掛け算した結果を合計します。
最も左のブロックは位置0にあります。ブロックが空き領域である場合は計算を飛ばします。

最初の例を続けると、最初のいくつかのブロックの位置にそのファイルID番号を掛けた結果は
$0 \times 0 = 0, 1 \times 0 = 0, 2 \times 9 = 18, 3 \times 9 = 27, 4 \times 8 = 32, \dots$
というようになります。
この例では、チェックサムはこれらの合計の1928です。

ヨコエビのハードドライブを彼が望む手順を使用して密集化してください。
結果として得られるファイルシステムのチェックサムはいくつですか？
（このパズルの入力をコピー/ペーストする際は注意してください。それは非常に長い1行です。）

# パート2

完了すると、2つのことがすぐに明らかになりました。
まず、ディスクには確かに連続した空き領域がずっと多くあります。これはヨコエビが期待していた通りです。
次に、コンピュータの動作がずっと遅くなっています！
ファイルシステムの断片化を招くのは悪いアイデアだったのかも？

熱心なヨコエビは既に新しい計画を持っています：
個々のブロックを移動するのではなく、
彼はディスク上の**ファイルを分けずにまるごと**移動することでファイルを密集化してみたいと考えています。

今回は、ファイルをそれが収まるような最も左の空き領域ブロックに移動させることを試みます。
ファイルID番号が高いファイルから順に、ID番号の降順に、それぞれのファイルを一度だけ移動させることを試みます。
ファイルの左側にそのファイルを収容できる空き領域がない場合、そのファイルは移動しません。

上記の最初の例は、今は異なる進行をします：

```
00...111...2...333.44.5555.6666.777.888899
0099.111...2...333.44.5555.6666.777.8888..
0099.1117772...333.44.5555.6666.....8888..
0099.111777244.333....5555.6666.....8888..
00992111777.44.333....5555.6666.....8888..
```

ファイルシステムのチェックサムを更新するプロセスは同じです。
今回、この例のチェックサムは2858になります。

最初からやり直し、この新しい方法を使ってヨコエビのハードドライブを密集化します。
結果として得られるファイルシステムのチェックサムはいくつですか？
