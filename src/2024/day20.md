# Day 20: レースコンディション

（レースの状態、と、デジタル回路用語の競合状態、を掛けている）

歴史学者たちは再びかなりドット絵化しています。
今回は、巨大な黒い建物があなたの上にそびえ立っています ー
あなたはCPUの[すぐ外](../2017/day24.md)にいます！

歴史学者たちが作業を始めると、近くのプログラムがあなたがアイドル状態であることを察知し、**レース**を挑んできます。
どうやら、頻繁に開催される**レースコンディション**フェスティバルにちょうど間に合ったようです！
<!-- 頻繁にあったらダメじゃんww -->

レースは特に長くて曲がりくねったコードパスで行われます。
プログラムたちは、誰が**最少のピコ秒**でゴールに到着するかを競います。
勝者には自分専用の**mutex**が贈られます！

彼らは**レースコース**の地図（あなたのパズル入力）を手渡します。
例えば：

```
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

地図はコース (`.`) で構成されています。また**スタート** (`S`) と**エンド** (`E`)の位置
（どちらもトラックとみなします）を含み、壁 (`#`) があります。

プログラムがレースコースを走るとき、スタート位置から出発します。
その後、上、下、左、右に移動することが許されており、その各移動には**1ピコ秒**かかります。
目標は、できるだけ早くエンド位置に到達することです。
この例のレーストラックでは、最速タイムは84ピコ秒です。

スタートからゴールまでの道はひとつしかなく、プログラムは全て同じ速度で進むため、レースはかなり退屈でした。
もっと面白くするために、レースに新しいルールが導入されました：
プログラムは**チート**をすることが許されています。

チートの規則は非常に厳格です。<!-- 腸捻転な文章だ！ -->
レース中に**きっかり一度**だけ、プログラムは**最大2ピコ秒**の間、**衝突判定を無効化**することができます。
これにより、プログラムは通常のコースであるかのように**壁を通過する**ことができます。
**チート**が終了した時点で、プログラムは再び通常のコースに戻っていなければなりません。
さもなくば**セグメンテーションフォルト**が発生し、失格となります。
<!-- かべのなかにいる -->

したがって、プログラムは、下の図で `1` と `2` と印した2つの移動でチートを行うことで、
72ピコ秒でコースを走破することができます（**12ピコ秒**を節約）：

```
###############
#...#...12....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

あるいは、プログラムが下の図で `1` と `2` と印した2つの移動でチートを行うことで、
64ピコ秒でコースを走破することができます（**20ピコ秒**を節約）：

```
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...12..#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

下図のチートは**38ピコ秒**を節約します：

```
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.####1##.###
#...###.2.#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

このチートは**64ピコ秒**を節約し、プログラムを直接エンドの位置に導きます：

```
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..21...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

各チートには固有の**開始位置**（チートを発動させる位置、壁を通過する最初の移動の直前）と**終了位置**があります。
<!-- ここでちゃんと定義していたか… -->
チートはその開始位置と終了位置によって一意に識別されます。

この例では、チートの総数（節約される時間により分類）は次のとおりです：

|節約ピコ秒|個数|
|--:|--:|
|2|14|
|4|14|
|6|2|
|8|4|
|10|2
|12|3|
|20|1|
|36|1|
|38|1|
|40|1|
|64|1|

レースコースのコンディションがどうなるかわからないので、
できるだけ多くの選択肢を持つために、最良のチートのリストが必要です。
少なくとも100ピコ秒を節約できるチートはいくつありますか？

# パート2

プログラムはあなたのチートのリストに困惑しているようです。
どうやら、2ピコ秒のチートルールは数ミリ秒前に廃止されたようです！
最新版のチート規則では、最大**20ピコ秒**続く単一のチートが可されています。

今、2ピコ秒で可能だった全てのチートに加えて、さらに多くのチートが可能です。
この6ピコ秒のチートは**76ピコ秒**を節約します：

```
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#1#####.#.#.###
#2#####.#.#...#
#3#####.#.###.#
#456.E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

下図のチートは上図のものと同じ開始位置と終了位置を持っているため、
チート中の経路が異なっていても**同じチート**です：

```
###############
#...#...#.....#
#.#.#.#.#.###.#
#S12..#.#.#...#
###3###.#.#.###
###4###.#.#...#
###5###.#.###.#
###6.E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
```

チートは20ピコ秒全てを使用する必要はありません。
チートは20ピコ秒までの任意の時間持続することができます。
（ただし、プログラムが通常のコースにいるときにのみ終了できます。）
使用されなかったチート時間は失います。
後のチートのために保存することはできません。

やはり最良のチートのリストが必要ですが、今では選択肢がさらに増えています。
例の地図では、**50ピコ秒以上**を節約するチートの個数は次のとおりです：

|節約ピコ秒|個数|
|--:|--:|
|50|32|
|31|52|
|54|29|
|56|39|
|58|25|
|60|23|
|62|20|
|64|19|
|66|12|
|68|14|
|70|12|
|72|22|
|74|4|
|76|3|

更新されたチート規則を使用して最良のチートを見つけてください。
少なくとも100ピコ秒を節約できるチートはいくつありますか？

<details><summary>訳補足</summary>

チートは、始点と終点だけで区別される、というのが規則なので、下図のような状況（英文字はコースとする）について、

```
###############
abcde..#..vwxyz
###############
```

aからv, aからw, …, aからz, bからv,…,eからz の25通りのチートは、どれも中心の壁1枚を抜けるだけで実質同じだが**全て違うものとして数える**。

自分はわざわざこれを同一視する計算を書いて
```
That's not the right answer; your answer is too low.
```
と言われたマヌケです。
問題文をちゃんと読めば
```
cheats are uniquely identified by their start position and end position.
```
と確かに書いてある。

</details>
