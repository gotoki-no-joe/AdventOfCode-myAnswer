# 7日目：再帰サーカス #

コンピュータの回路をさらにさまようと、プログラムの塔に出会った。
彼らは少々問題を抱えているようだ。
再帰的なアルゴリズムをなくしてしまったため、
現在は大きなタワーで不安定にバランスが取れています。

一番下のプログラムはタワー全体を支えています。
それは大きなディスクを保持しており、
ディスク上には複数のサブタワーがバランスを取っています。
これらのサブタワーの最下層では、
底のディスクに立って、
それぞれ**独自の**ディスクを保持する他のプログラム群があります。
この構造が続いています。
これらのサブサブサブ…タワーの最上部では、
無数のプログラムが自分のディスクは持たず
自分の下にあるディスクのバランスを保つことだけをしています。

あなたは助けを申し出ましたが、
その前にこれらの塔の構造を理解する必要があります。
あなたはそれぞれのプログラムに
自分のの**名前**、**体重**、
そして（ディスクを持っている場合）
そのディスクの上でバランスをとっている
そのすぐ上のプログラムの名前を叫ぶように頼みます。
この情報を書き留めます（あなたのパズル入力）。
残念なことに、彼らはパニック状態にあり、
これを整然と行うことなどできません。
あなたが書き終えた時点で、どのプログラムがどの情報を与えたか分かりません。

たとえば、あなたのリストが次の場合：

~~~
pbga (66)
xhth (57)
ebii (61)
havc (66)
ktlj (57)
fwft (72) -> ktlj, cntj, xhth
qoyq (66)
padx (45) -> pbga, havc, qoyq
tknk (41) -> ugml, padx, fwft
jptl (61)
ugml (68) -> gyxo, ebii, jptl
gyxo (61)
cntj (57)
~~~

...あなたは次のように塔の構造を再現することができます。

~~~
                gyxo
              /
         ugml - ebii
       /      \
      |         jptl
      |
      |         pbga
     /        /
tknk --- padx - havc
     \        \
      |         qoyq
      |
      |         ktlj
       \      /
         fwft - cntj
              \
                xhth
~~~

この例では、`tknk`が塔の最下層（**底プログラム**）で、
それが`ugml`, `padx`, `fwft`を支えています。
これらのプログラムは順に他のプログラムを支えています。
この例では、そこで支えられているプログラムはどれも
他のプログラムを支えてはおらず、すべて自分の塔の頂点になっています。
（あなたの目の前にある実際のバランスしている塔はこれよりはるかに大きいです。）

あなたが彼らを助ける準備を整える前に、
あなたの情報が正しいことを確認する必要があります。
**底プログラムの名前は何ですか？**

# パート2 #

プログラムは状況を説明します。彼らは倒れるわけにはいきません。
むしろ、タワーのバランスを保つためにすべてのエネルギーを費やしていなければ、
彼らは**倒れてしまう**でしょう。
どうやら、1つのプログラムの**体重が間違っていて**、
修正されるまでは、この状態で行き詰まったままです。

ディスクを保持しているプログラムについて、
そのディスク上に立っている各プログラムはサブタワーを形成する。
それらの各サブタワーはそれぞれ同じ重量であるはずであり、
さもなくばディスクはそのバランスがとれない。
塔の重量は、その塔のプログラムの体重の合計です。

上記の例では、これは、
`ugml`のディスクのバランスをとるために、
`gyxo`, `ebii`, `jptl` のすべてが同じ重量61を持つ必要がある
ことを意味します。そして確かにそうなっています。

しかしながら、`tknk`がバランスを取るためには、
ディスク上に立っているプログラムと**その上にあるすべてのプログラム**が
それぞれ一致しなければなりません。
つまり、次の合計はすべて同じでなければなりません。

- `ugml` + (`gyxo` + `ebii` + `jptl` ) = 68 +（61 + 61 + 61）= 251
- `padx` + (`pbga` + `havc` + `qoyq` ) = 45 +（66 + 66 + 66）= 243
- `fwft` + (`ktlj` + `cntj` + `xhth` ) = 72 +（57 + 57 + 57）= 243

見てわかるように、`tknk`のディスクはバランスが取れていません。
`ugml`の塔は他の2つよりも重いです。
`ugml`の上のノードはバランスが取れているにもかかわらず、
`ugml`自体が重すぎます。
自分の塔全体の重量を243にしてタワーのバランスを保つためには、
8単位だけ軽くなる必要があります。
この変更が行われた場合、その重量は60となります。

ただ1つのプログラムだけが間違った体重であるとすると、
タワー全体のバランスを取るためには
**そのプログラムの体重をいくつにすればよいでしょうか？**
