# 13日目：私のカートの狂気 #

この規模の作物は、農産物、土壌、肥料などを
輸送するためにかなりの物流を必要とします。
妖精たちは、彼らが思いついたある種の未発達な軌道のシステムで、
**カート**で何かを押して運ぶのに非常に忙しいです。

カートと軌道のシステムは
記録された歴史に登場するのはもう1000年は後のことなので、
妖精達は独自にこれらを発展させているようです。(?)
彼らはまだ衝突を回避する方法を考え出していない。

あなたは軌道（あなたのパズル入力）を精密に記し、
あなたが助けることができる場所を調べます。

軌道は直線経路（`|`および`-`）、カーブ（`/`および`\`）、
交差点（`+`）で構成されます。
カーブはちょうど2つの垂直な軌道の一部を接続する。
たとえば、これは閉ループです。

~~~
/----\
|    |
|    |
\----/
~~~

交差点は、2つの垂直な経路が交差するときに発生します。
交差点では、カートは左折、右折、直進をすることができます。
ここに2つの交差点で接続された2つのループがあります。

~~~
/-----\
|     |
|  /--+--\
|  |  |  |
\--+--/  |
   |     |
   \-----/
~~~

軌道にはいくつかの**カート**があります。
カートは常に上（`^`）、下（`v`）、左（`<`）、右（`>`）のいずれかに向いています。
（入力の地図では、
各カートの下の軌道は、カートが向いている方向に一致する直線経路です。）

カートが（いずれかの交差点に到着することで）向きを変える選択肢を得る
ときは常に、
1回目は**左***に曲がり、2回目は**直進**し、3回目は**右折**し、
またこれを初めから繰り返すので、
4回目は**左**に、5回目は**直進**、以下同様です。
この手順はカートが到着した交差点がどれかという事からは独立しています。
つまり、カートには交点ごとの記憶がありません。

カートはすべて同じ速度で動きます。
彼らは一度に1歩ずつ順番に動きます。
彼らは**現在の位置**に基づいてこれを行います。
一番上の行のカートが最初に動いて（左から右へ）、
次に2行目のカートが（やはり左から右へ）移動し、
次に3行目のカートが移動し、と続きます。
各カートが1ステップ移動すると、手順が繰り返されます。
これらのループのそれぞれを**ティック**（最小の時間単位）と呼びます。

たとえば、直進トラックに2台のカートがあるとします。

~~~
|  |  |  |  |
v  |  |  |  |
|  v  v  |  |
|  |  |  v  X
|  |  ^  ^  |
^  ^  |  |  |
|  |  |  |  |
~~~
まず一番上のカートが動きます。
それは下向き（`v`）であるので、1つ下のマスに移動します。
次に下のカートが動きます。
それは上を向いている(`^`)ので、1つ上に移動します。
すべてのカートが動いたので、最初のティックが終了します。
次に、最初のカートから開始して、手順が繰り返されます。
最初のカートが下に移動し、次に2番目のカートが上に移動します。
これは最初のカートのいるところで、衝突します！
（衝突の位置は`X`で印しされています。）
これで2番目で最後のティックが終了します。

もっと長い例があります：

~~~
/->-\        
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/   

/-->\        
|   |  /----\
| /-+--+-\  |
| | |  | |  |
\-+-/  \->--/
  \------/   

/---v        
|   |  /----\
| /-+--+-\  |
| | |  | |  |
\-+-/  \-+>-/
  \------/   

/---\        
|   v  /----\
| /-+--+-\  |
| | |  | |  |
\-+-/  \-+->/
  \------/   

/---\        
|   |  /----\
| /->--+-\  |
| | |  | |  |
\-+-/  \-+--^
  \------/   

/---\        
|   |  /----\
| /-+>-+-\  |
| | |  | |  ^
\-+-/  \-+--/
  \------/   

/---\        
|   |  /----\
| /-+->+-\  ^
| | |  | |  |
\-+-/  \-+--/
  \------/   

/---\        
|   |  /----<
| /-+-->-\  |
| | |  | |  |
\-+-/  \-+--/
  \------/   

/---\        
|   |  /---<\
| /-+--+>\  |
| | |  | |  |
\-+-/  \-+--/
  \------/   

/---\        
|   |  /--<-\
| /-+--+-v  |
| | |  | |  |
\-+-/  \-+--/
  \------/   

/---\        
|   |  /-<--\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/   

/---\        
|   |  /<---\
| /-+--+-\  |
| | |  | |  |
\-+-/  \-<--/
  \------/   

/---\        
|   |  v----\
| /-+--+-\  |
| | |  | |  |
\-+-/  \<+--/
  \------/   

/---\        
|   |  /----\
| /-+--v-\  |
| | |  | |  |
\-+-/  ^-+--/
  \------/   

/---\        
|   |  /----\
| /-+--+-\  |
| | |  X |  |
\-+-/  \-+--/
  \------/   
~~~

しばらくの間、それぞれの道をたどった後、カートは結局衝突する。
衝突を防ぐために、最初の衝突の位置を知りたいと思います。
位置は`X,Y`座標で与えられます。
最も左の列が`X=0`であり、
一番上の行が`Y=0`です。

~~~
           111
 0123456789012
0/---\        
1|   |  /----\
2| /-+--+-\  |
3| | |  X |  |
4\-+-/  \-+--/
5  \------/   
~~~

この例では、最初の衝突の場所は`7,3`です。

# パート2 #

このばかげたシステムで衝突を防ぐためにできることはあまりありません。
しかし、衝突を予測することによって、
妖精たちはそれがどこで起きるのか事前に知ることになり、
衝突が発生したときに
**2つの事故車を即座に撤去する**ことができます。

彼らはこのやり方でしばらく進めることができますが、
最終的にはカートを使い果たしてしまいます。
最後まで**衝突せずに残った**カートが
いる位置がどこになるかを調べると便利です。

例えば：

~~~
/>-<\  
|   |  
| /<+-\
| | | v
\>+</ |
  |   ^
  \<->/

/---\  
|   |  
| v-+-\
| | | |
\-+-/ |
  |   |
  ^---^

/---\  
|   |  
| /-+-\
| v | |
\-+-/ |
  ^   ^
  \---/

/---\  
|   |  
| /-+-\
| | | |
\-+-/ ^
  |   |
  \---/
~~~

4つの非常に高価な衝突の後、
ティックは1つのカートだけ残して終了します。
その最終的な位置は6,4です。

最後の1台だけが残ったティックの終わりに
**その最後のカートがある位置**はどこですか？
