# 20日目：海溝の地図 #

スキャナが完全に展開されたら、海溝の床の地図作成に注意を向けます。

スキャナから画像を取り込むと、それは単なるランダムノイズのように見えます。
画像強調アルゴリズムと入力画像（パズル入力）を組み合わせて、
少し見やすくすることができるでしょう。

例えば：

```
..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..##
#..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###
.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#.
.#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#.....
.#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#..
...####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.....
..##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#

#..#.
#....
##..#
..#..
..###
```

前半の部分は**画像強調アルゴリズム**です。
通常は1行で記述しますが、この例では読みやすくするために複数行に折り返されています。
後半の部分は**入力画像**で、**明るいピクセル** (`#`) と**暗いピクセル** (`.`) の2次元格子です。

画像強調アルゴリズムは、入力画像のすべてのピクセルを**同時に**出力画像に変換することによって画像を強調する方法を説明します。
出力画像の各ピクセルは、対応する入力画像のピクセルを中心とする3x3の正方形のピクセルを調べることによって決定されます。
したがって、出力画像の (5,10) のピクセルの値を決定するには、
入力画像の9つのピクセル
(4,9), (4,10), (4,11), (5,9), (5,10), (5,11), (6,9), (6,10), (6,11)
を考慮する必要があります。
これらの9つの入力ピクセルは、**画像強調アルゴリズム**文字列の添え字として使用される1つの2進数に結合されます。

たとえば、入力画像のちょうど真ん中のピクセルに対応する出力ピクセルを決定するには、
`[...]` で記された9つのピクセルを考慮する必要があります。

```
# . . # .
#[. . .].
#[# . .]#
.[. # .].
. . # # #
```

左上から開始し、各列を横切って読み取ると、それらのピクセルは `...`、次いで `#..`、その後 `.#.`で、
これらを組み合わせると `...#...#.` を形成します。
暗いピクセル (`.`) を0に、明るいピクセル (`#`) を1にすると、
2進数`000100010`が得られます。これは10進数で34です。

画像強調アルゴリズムの文字列の長さはちょうど512文字で、
これはすべての9ビットの2進数と対応させるのに十分です。
文字列の先頭の何文字か（零から数え始めます）は次のとおりです。
（原文では34のところが強調表示）

```
0         10        20        30  34    40        50        60        70
|         |         |         |   |     |         |         |         |
..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..##
```

この先頭の文字群の中央、34文字目に `#` の文字があります。
したがって、出力画像の中央にある出力ピクセルは、**明るいピクセル** (`#`) となります。

この処理を繰り返して、出力画像のすべてのピクセルを計算できます。

画像技術の進歩により、ここで操作される画像の大きさは**無限**になります。
無限出力画像の**すべての**ピクセルは、入力画像の関連するピクセルに基づいて正確に計算する必要があります。
あなたが持っている小さな入力画像は、実際の無限の入力画像のほんの小さな領域です。
入力画像の残りの部分は暗いピクセル (`.`) で構成されています。
例を示すにあたって紙面を節約するために、無限サイズの入力および出力画像の一部のみが表示されます。

したがって、開始入力画像は次のようになり、
ここに示されていないすべての方向にさらに暗いピクセル (`.`) が無限に広がっています。

```
...............
...............
...............
...............
...............
.....#..#......
.....#.........
.....##..#.....
.......#.......
.......###.....
...............
...............
...............
...............
...............
```

画像強調アルゴリズムをすべてのピクセルに同時に適用することにより、次の出力画像が得られます。

```
...............
...............
...............
...............
.....##.##.....
....#..#.#.....
....##.#..#....
....####..#....
.....#..##.....
......##..#....
.......#.#.....
...............
...............
...............
...............
```

画像処理技術のさらなる進歩により、上の出力画像は入力画像としても使用できます！
これにより、**2回目**の強調が可能になります。

```
...............
...............
...............
..........#....
....#..#.#.....
...#.#...###...
...#...##.#....
...#.....#.#...
....#.#####....
.....#.#####...
......##.##....
.......###.....
...............
...............
...............
```

本当に信じられないほどです。詳細が明らかになりつつあります。
元の入力画像を2回強調した後、35ピクセルが点灯しています。

元の入力画像から始めて、画像強調アルゴリズムを2回適用します。
画像の大きさが無限であることに注意してください。
**結果の画像で何ピクセルが点灯していますか？**

# パート2 #

あなたはまだ画像の詳細を完全に取り出せていません。
おそらくあなたはそれを十分に強調していません。

上記の例で開始入力画像を合計50回強調すると、最終出力画像で3351ピクセルが点灯します。

元の入力画像からやり直し、画像強調アルゴリズムを50回適用します。
**結果の画像で何ピクセルが点灯しますか？**
