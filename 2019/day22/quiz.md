# 22日目：ばしばしシャッフル #

ドロイドがあなたの船を修理するのを待つ間、することはあまりありません。
少なくともあなたは正しい方向に漂流しています。
あなたはこれまで取り組んできた
新しいカード[シャッフル](https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%A3%E3%83%83%E3%83%95%E3%83%AB_(%E3%82%AB%E3%83%BC%E3%83%89))
を練習することにしました。

船の倉庫を漁って、一そろいの**宇宙トランプ**のデッキを見つけました！
宇宙トランプとはそういうものですが、デッキには0番から10006番までの番号の振られた10007枚のカードがあります。
デッキは**出荷状態**のままなので、それは新品に違いありません。
出荷状態とは、0番がいちばん上に、次に1番、次に2番、同様に続いて一番下に10006番となっていることをいいます。

シャッフル中に使用する3つの異なる**テクニック**を練習してきました。
10枚のカード（0から9まで）だけのデッキがあるとします：

**`deal into new stack`** とは、
新しいスタックの一番上にデッキの一番上のカードを配るという動作を
カードを使い果たすまで繰り返すことで、
カードの新しいスタックを作成するテクニックです。

```
上側           下側
0 1 2 3 4 5 6 7 8 9   デッキ
                      新しいスタック

  1 2 3 4 5 6 7 8 9   デッキ
                  0   新しいスタック

    2 3 4 5 6 7 8 9   デッキ
                1 0   新しいスタック

      3 4 5 6 7 8 9   デッキ
              2 1 0   新しいスタック

数ステップ後…

                  9   デッキ
  8 7 6 5 4 3 2 1 0   新しいスタック

                      デッキ
9 8 7 6 5 4 3 2 1 0   新しいスタック
```

最後に、作成したばかりの新しいスタックを手に取り、
次のテクニックのデッキとして使用します。

**`cut N`** とは、
デッキの一番上から`N`枚のカードをとり、
それを順序を保持して一つの塊としてデッキの一番下に動かすテクニックです。
たとえば`cut 3`は次のようになります：

```
上側           下側
0 1 2 3 4 5 6 7 8 9   デッキ

      3 4 5 6 7 8 9   デッキ
0 1 2                 カットしたカード

3 4 5 6 7 8 9         デッキ
              0 1 2   カットしたカード

3 4 5 6 7 8 9 0 1 2   デッキ
```

また、あなたはこのテクニックの`N`がマイナスのバージョンもかなり上手になっています！
その場合、`N`（の絶対値）枚のカードをデッキの底から上にカットします。
たとえば`cut -4`は次のようになります：

```
上側           下側
0 1 2 3 4 5 6 7 8 9   デッキ

0 1 2 3 4 5           デッキ
            6 7 8 9   カットしたカード

        0 1 2 3 4 5   デッキ
6 7 8 9               カットしたカード

6 7 8 9 0 1 2 3 4 5   デッキ
```

**`deal with increment N`** というテクニックは、
まず、すべてのカードを長い一列に並べられるようにテーブル上に十分なスペースを空けます。
一番上のカードを一番左の位置に配ります。
次に、右に`N`枚ぶん位置を移動し、そこへ次のカードを配ります。
テーブルのスペースの終わりを過ぎた位置に移動する場合は、
巻き戻して一番左のカードから再び数え続けます。
カードがなくなるまでこの手順を続けます。

たとえば`deal with increment 3`は：

```
0 1 2 3 4 5 6 7 8 9   デッキ
. . . . . . . . . .   テーブルのスペース
^                     現在位置

現在位置に一番上のカードを配ります：

  1 2 3 4 5 6 7 8 9   デッキ
0 . . . . . . . . .   テーブルのスペース
^                     現在位置

現在位置を右に3動かします：

  1 2 3 4 5 6 7 8 9   デッキ
0 . . . . . . . . .   テーブルのスペース
      ^               現在位置

一番上のカードを配ります：

    2 3 4 5 6 7 8 9   デッキ
0 . . 1 . . . . . .   テーブルのスペース
      ^               現在位置

右に3移動して配ります：

      3 4 5 6 7 8 9   デッキ
0 . . 1 . . 2 . . .   テーブルのスペース
            ^         現在位置

右に3移動して配ります：

        4 5 6 7 8 9   デッキ
0 . . 1 . . 2 . . 3   テーブルのスペース
                  ^   現在位置

右に3移動するときに巻き戻して、そして配ります：

          5 6 7 8 9   デッキ
0 . 4 1 . . 2 . . 3   テーブルのスペース
    ^                 現在位置

以下同様に続いて：

0 7 4 1 8 5 2 9 6 3   テーブルのスペース
```

すでにカードが配られているテーブル上の位置も引き続き数えます。
それらは飛ばしません。
もちろん、このテクニックは慎重に設計されているため、
2枚のカードが同じ位置に置かれたり、どこかの位置が空のままになることはありません。

最後に、テーブル上のカードを集めてデッキにします。
このとき、一番左のカードがデッキの一番上になり、
その右隣のカードが一番上のカードのすぐ下になり、
以下同様に、
一番右のカードが一番下のカードになるようにします。

完全なシャッフルプロセス（パズル入力）は、
これらのテクニックの様々に適用することから成ります。
以下に、テクニックを組み合わせた例をいくつか示します。
それらはすべて**出荷状態**の10枚のデッキから始まります。

```
deal with increment 7
deal into new stack
deal into new stack
結果: 0 3 6 9 2 5 8 1 4 7
```
```
cut 6
deal with increment 7
deal into new stack
結果: 3 0 7 4 1 8 5 2 9 6
```
```
deal with increment 7
deal with increment 9
cut -2
結果: 6 3 0 7 4 1 8 5 2 9
```
```
deal into new stack
cut -2
deal with increment 7
cut 8
cut -4
deal with increment 7
cut 3
deal with increment 9
deal with increment 3
cut -1
結果: 9 2 5 8 1 4 7 0 3 6
```

デッキ内の位置は上から順にカウントされ、一番上が0、
次に一番上のカードのすぐ下のカードが1、以下同様に続きます。
（つまり、カードは番号と一致する位置から始まります。）

10007枚の**出荷状態**のデッキをシャッフルした後、
**2019番のカードはどの位置にありますか？**
（位置2019にあるカードは何番ですか？ではないので注意。）

# パート2 #

しばらくして、シャッフルの技はカードデッキ1つぶんだけではそれほど向上しないことがわかります。
船の修理を確認している間に、船のすべての3Dプリンタにさらにカードを作成するよう依頼します。
ドロイドがこれまでに終了した作業を確認していると、
[ハレー彗星](https://ja.wikipedia.org/wiki/%E3%83%8F%E3%83%AC%E3%83%BC%E5%BD%97%E6%98%9F)が
飛び去って行くのを見た気がしました！

戻ってみると、3Dプリンターがその力を結集して、
**119315717514047枚の宇宙トランプ**が**出荷状態**にある
単一の巨大な真新しいデッキを完成させていました。

ようやく、シャッフルに値するカードのデッキを手に入れました！

あなたは完全なシャッフルプロセス（パズル入力）をこのデッキに
**連続して101741582076661回**適用しようと考えました。

ただし、注意する必要があります－
この大量のカードでひとつでも間違えると、
船全体が**オーバーフロー**する可能性があります！

あなたの新しい巨大な**出荷状態**デッキを何度もシャッフルした後、
**最終的に位置2020にくるカードは何番ですか？**
