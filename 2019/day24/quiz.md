# 24日目：不和の惑星 #

サンタに到達する前の最後の停泊地である[エリス](https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%AA%E3%82%B9_(%E6%BA%96%E6%83%91%E6%98%9F))に
着陸しました。
するとすぐに、センサーは動き回る奇妙な生命体を拾い始めます。
エリスには[虫](https://www.nationalgeographic.org/thisday/sep9/worlds-first-computer-bug/)がうじゃうじゃいます！
地球とあなたとの間でメッセージが往復するのには24時間以上かかるため、
あなたは自分でこの問題に対処する必要があります。

エリスはそれほど大きな場所ではありません。
領域全体のスキャンが5x5マス（パズル入力）に収まります。
スキャンでは、バグ(`#`)および空き空間(`.`)が表示されます。

**毎分**、バグは**4つの隣接するマス**のバグの数に基づいて生存および消滅します。

- **ちょうど1つ**のバグに隣接していないない限り、バグは**死にます**（空きになります）。
- **ちょうど1つまたは2つ**のバグが隣接している場合、空き空間に**バグが発生**します。

それ以外の場合、バグまたは空き空間は同じままです。
（グリッドの端のマスには、隣接するマスが4つよりも少なくなります。
欠落しているマスは空き空間として数えられます。）
このプロセスはすべてのマスで**同時に**起きます。
つまり、ある同じ1分に、隣接するバグの数が最初にすべてのマスに対して数えられ、次にマスが更新されます。

シナリオ例の最初の数分は次のとおりです。

```
初期状態:
....#
#..#.
#..##
..#..
#....

1 分後:
#..#.
####.
###.#
##.##
.##..

2 分後:
#####
....#
....#
...#.
#.###

3 分後:
#....
####.
...##
#.##.
.##.#

4 分後:
####.
....#
##..#
.....
##...
```

バグの性質を理解するために、
まずはバグと空き空間の配置が**以前の配置と一致する**のを観察してください。
上の例では、最初に2度現れる配置は次のとおりです。

```
.....
.....
.....
#....
.#...
```

この配置の**生物多様性度数**を計算するには、
各マスを一番上の行の左から右、次に2番目の行の左から右、というように考えます。
これらのマスのそれぞれは1, 2, 4, 8, 16, 32などの2の累乗の上昇列に等しい生物多様性ポイントに値します。
バグのあるマスの生物多様性ポイントを合計します。
この例では、16番目のマス（32768ポイント）と22番目のマス（2097152ポイント）にバグがあり、
生物多様性の合計評価は**2129920**です。

**最初に2度現れる配置の生物多様性の評価はいくつですか？**

# パート2 #

慎重に分析した結果、ひとつ確かなことがあります。
**これらのバグがどこから来たのかわからないのです。**

そして、あなたは思い出しました：
エリスは[冥王星人](../day20/quiz.md)の古い植民地です！
明らかに、バグは再帰的に折り畳まれた空間から来ています。

この5x5のマスは、**無限**の再帰レベルの**たかだか1つ**のレベルにすぎません。
グリッドの中央のマスは実際には別の5x5マスであり、
あなたがスキャンしたグリッドはより大きな5x5グリッドにその中央のマスとして含まれています。
グリッドの2つのレベルは次のようになります。

```
     |     |         |     |     
     |     |         |     |     
     |     |         |     |     
-----+-----+---------+-----+-----
     |     |         |     |     
     |     |         |     |     
     |     |         |     |     
-----+-----+---------+-----+-----
     |     | | | | | |     |     
     |     |-+-+-+-+-|     |     
     |     | | | | | |     |     
     |     |-+-+-+-+-|     |     
     |     | | |?| | |     |     
     |     |-+-+-+-+-|     |     
     |     | | | | | |     |     
     |     |-+-+-+-+-|     |     
     |     | | | | | |     |     
-----+-----+---------+-----+-----
     |     |         |     |     
     |     |         |     |     
     |     |         |     |     
-----+-----+---------+-----+-----
     |     |         |     |     
     |     |         |     |     
     |     |         |     |     
```

（画面を節約するために、一部のマスは縮尺どおりに描かれていません。）
これは無限再帰グリッドのごく一部にすぎないことに注意してください。
この図を含む5x5グリッドがあり、それを含む5x5グリッドがあり、とどこまでも続きます。
また、図の`?`には別の5x5グリッドが含まれており、
それ自体に別の5x5グリッドが含まれており、これもいつまでも続きます。

行ったスキャン（パズル入力）は、
この構造の**ある単一レベル**のバグの場所を示しています。
スキャンの中央のマスはその中に再帰的にグリッドを収容するために空です。
最初は、他のレベルにはバグはいません。

マスはやはり、あるマスのすぐ**上下左右**にある場合、**隣接**と見なされます。
一部のマスには、自身のレベルよりも上または下の再帰レベルに隣接するマスがあります。
例えば：

```
     |     |         |     |     
  1  |  2  |    3    |  4  |  5  
     |     |         |     |     
-----+-----+---------+-----+-----
     |     |         |     |     
  6  |  7  |    8    |  9  |  10 
     |     |         |     |     
-----+-----+---------+-----+-----
     |     |A|B|C|D|E|     |     
     |     |-+-+-+-+-|     |     
     |     |F|G|H|I|J|     |     
     |     |-+-+-+-+-|     |     
 11  | 12  |K|L|?|N|O|  14 |  15 
     |     |-+-+-+-+-|     |     
     |     |P|Q|R|S|T|     |     
     |     |-+-+-+-+-|     |     
     |     |U|V|W|X|Y|     |     
-----+-----+---------+-----+-----
     |     |         |     |     
 16  | 17  |    18   |  19 |  20 
     |     |         |     |     
-----+-----+---------+-----+-----
     |     |         |     |     
 21  | 22  |    23   |  24 |  25 
     |     |         |     |     
```

- マス19には14, 18, 20, 24の4つの隣接するマスがあります。
- マスGにはB, F, H, Lの4つの隣接するマスがあります。
- マスDには8, C, E, Iの4つの隣接するマスがあります。
- マスEには8, D, 14, Jの4つの隣接するマスがあります。
- マス14には9, E, J, O, T, Y, 15, 19の**8つ**の隣接するマスがあります。
- マスNにはI, O, S, および`?`と印されたサブグリッド内の5つのマスの**8つ**の隣接するマスがあります。

バグの生存と死に関するルールは以前と同じです。

例として、上と同じ初期状態を考えます。

```
....#
#..#.
#.?##
..#..
#....
```

中央のマスは次の再帰グリッドを表すために`?`と描画されます。
このレベルを0と呼びましょう。
このグリッド内のグリッドはレベル1で、
このグリッドを含むグリッドはレベル-1です。
そして**10分後**、各レベルのグリッドは次のようになります。

```
レベル -5:
..#..
.#.#.
..?.#
.#.#.
..#..

レベル -4:
...#.
...##
..?..
...##
...#.

レベル -3:
#.#..
.#...
..?..
.#...
#.#..

レベル -2:
.#.##
....#
..?.#
...##
.###.

レベル -1:
#..##
...##
..?..
...#.
.####

レベル 0:
.#...
.#.##
.#?..
.....
.....

レベル 1:
.##..
#..##
..?.#
##.##
#####

レベル 2:
###..
##.#.
#.?..
.#.##
#.#..

レベル 3:
..###
.....
#.?..
#....
#...#

レベル 4:
.###.
#..#.
#.?..
##.#.
.....

レベル 5:
####.
#..#.
#.?#.
####.
.....
```

この例では10分後に合計**99**匹のバグが存在します。

あなたのスキャンから開始して**200分後にバグは何匹が存在しますか？**
