# 7日目：増幅回路 #

航宙図によると、時間内にサンタに到達するには、船の補助エンジンにより多くの電力を送る必要があります。
これを行うには、既に船に据え付けられている一連の**増幅器**を調整する必要があります。

直列に接続された5つの増幅器があります。
それぞれが入力信号を受け取り出力信号を生成します。
これらは、最初の増幅器の出力が2番目の増幅器の入力につながり、
2番目の増幅器の出力が3番目の増幅器の入力につながるように接続され、と続きます。
最初の増幅器の入力値は0で、最後の増幅器の出力は船の補助エンジンにつながります。

```
    O-------O  O-------O  O-------O  O-------O  O-------O
0 ->| Amp A |->| Amp B |->| Amp C |->| Amp D |->| Amp E |-> (補助エンジンへ)
    O-------O  O-------O  O-------O  O-------O  O-------O
```

妖精は、[既存のIntcodeコンピュータ](../day5/quiz.md)で実行する必要のある
**増幅器制御ソフトウェア**（パズル入力）を送信しました。
各増幅器でプログラムのコピーを実行する必要があります。

プログラムのコピーが増幅器で実行を開始すると、
まず入力命令を使用して、増幅器に現在の**位相設定**（0〜4の整数）を要求します。
各位相設定値は**ちょうど1回だけ重複なく**使用されますが、
妖精はどの増幅器にどの位相設定が必要なのかを思い出せません。

その後、プログラムは別の入力命令を呼び出して増幅器の入力信号を取得し、
正しい出力信号を計算して、出力命令により増幅器に返します。
（増幅器がまだ入力信号を受信して​​いない場合、入力信号が到着するまで待機します。）

あなたの仕事は、増幅器の位相設定のあらゆる可能な組み合わせを試して、
**補助エンジンに送信できる最大の出力信号を見つける**ことです。
プログラムのコピー間でメモリが共有または再利用されないように注意してください。

例えば、位相設定列`3,1,2,4,0`を試してみたいと仮定します。
これは、増幅器Aを位相設定3に、増幅器Bを設定1に、Cを2、Dを4、Eを0に設定することを意味します。
次に、次の手順で増幅器Eから補助エンジンに送信される出力信号を決定できます。

- 増幅器Aで実行される増幅器制御ソフトウェアのコピーを開始します。
最初の入力命令で、増幅器の位相設定3を与えます。
2番目の入力命令で、入力信号0を与えます。
いくつかの計算の後、プログラムは出力命令を使用して増幅器の出力信号を示します。
- 増幅器Bのソフトウェアを起動します。
それに位相設定`1`と、増幅器Aから生成された出力信号を与えてください。
すると、増幅器C向けの新しい出力信号が生成されます。
- 増幅器Cのソフトウェアを起動し、位相設定`2`と増幅器Bからの値を指定して、その出力信号を受け取ります。
- 増幅器Dのソフトウェアを実行し、位相設定`4`と入力値を与え、その出力信号を受け取ります。
- 増幅器Eのソフトウェアを実行し、位相設定`0`と入力値を与え、その出力信号を受け取ります。

増幅器Eからの最終的な出力信号は補助エンジンに送信されます。
ただし、この位相設定列は最良のものではないかもしれません。
より高い信号を補助エンジンに送信する別の設定列があるかもしれません。

以下にプログラムの例を示します。

- 最大信号**43210**（位相設定列`4,3,2,1,0`）
```
3,15,3,16,1002,16,10,16,1,16,15,15,4,15,99,0,0
```
- 最大信号**54321**（位相設定列`0,1,2,3,4`）
```
3,23,3,24,1002,24,10,24,1002,23,-1,23,
101,5,23,23,1,24,23,23,4,23,99,0,0
```
- 最大信号**65210**（位相設定列`1,0,4,3,2`）
```
3,31,3,32,1002,32,10,32,1001,31,-2,31,1007,31,0,33,
1002,33,7,33,1,33,31,31,1,32,31,31,4,31,99,0,0,0
```

増幅器の位相設定のあらゆる組み合わせを試してください。
**補助エンジンに送信できる最大の信号はいくつですか？**

# パート2 #

うまくいきません。
この構成では、増幅器は必要な推力を生成するのに十分な大きさの出力信号を生成できません。
妖精は、増幅器を再配線して**フィードバックループ**にする方法をすばやく説明します。

```
      O-------O  O-------O  O-------O  O-------O  O-------O
0 -+->| Amp A |->| Amp B |->| Amp C |->| Amp D |->| Amp E |-.
   |  O-------O  O-------O  O-------O  O-------O  O-------O |
   |                                                        |
   '--------------------------------------------------------+
                                                            |
                                                            v
                                                     (補助エンジンへ)
```

ほとんどの増幅器は以前と同じように接続されています。
増幅器Aの出力は増幅器Bの入力に接続されます。
**ただし**、増幅器Eからの出力は増幅器Aの入力に接続されています。
これによりフィードバックループが作成されます。
信号は増幅器を通り何度も送信されます。

フィードバックループモードでは、増幅器は**以前と全く異なる位相設定**をとります。
それは整数5から9で、今回もそれぞれ一度だけ重複なく使用します。
これらの設定により、増幅器制御ソフトウェアは停止するまでに何度も繰り返し入力を受け取り出力を生成します。
各増幅器の最初の入力命令で位相設定を与えます。
それ以降のすべての入出力命令は信号用です。

この手順の中で、どの増幅器の増幅器制御ソフトウェアも再起動しないでください。
全てのコンピュータはそれぞれ、停止するまで信号の送受信を続けます。

この手順において送受信されるすべての信号は、最初の信号と最後の信号を除き、増幅器の対の間で送信されます。
手順を開始するために、信号`0`が増幅器Aの入力に**ちょうど一度だけ**送信されます。

最終的に、増幅器のソフトウェアは最後の周回を処理した後に停止します。
これが起きると、増幅器`E`からの最後の出力信号が補助エンジンに送信されます。
あなたの仕事は、新しい位相設定とフィードバックループ構成を使用したとき、
**補助エンジンに送信できる最大の出力信号を見つける**ことです。

以下にプログラムの例を示します。

- 最大信号**139629729**（位相設定列`9,8,7,6,5`）
```
3,26,1001,26,-4,26,3,27,1002,27,2,27,1,27,26,
27,4,27,1001,28,-1,28,1005,28,6,99,0,0,5
```
- 最大信号**18216**（位相設定列`9,7,8,5,6`）
```
3,52,1001,52,-5,52,3,53,1,52,56,54,1007,54,5,55,1005,55,26,1001,54,
-5,54,1105,1,12,1,53,54,53,1008,54,0,55,1001,55,1,55,2,53,55,53,4,
53,1001,56,-1,56,1005,56,6,99,0,0,0,0,10
```

増幅器のフィードバックループに対して新しい位相設定のすべての組み合わせを試してください。
**補助エンジンに送信できる最大の信号はいくつですか？**
