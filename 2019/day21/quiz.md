# 21日目：ばねロボットの冒険 #

冥王星から離陸し、サンタの方向に飛び始めます。

牽引ビームをさらに実験しているときに、誤って小惑星を直接船に引き込んでしまいました！
船体に大きな損傷を与え、船を激しく異常回転させます。

調査のためにドロイドを送り出すことはできますが、回転は人工的な重力を引き起こしているため、
一歩間違えばドロイドは船体の穴から宇宙に飛び出してしまうでしょう。

この任務の確かな正しい選択は、船体の穴を**飛び越える**ことができるドロイド、つまり**ばねロボット**です。

ばねロボットをプログラムするために[ASCII入出力可能な](../day17/quiz.md)コンピュータで実行される
[Intcode](../day9/quiz.md)プログラム（あなたのパズル入力）が利用できます。
ただし、ばねロボットはIntcodeを実行しません。
代わりに、バネスクリプトと呼ばれる単純化されたアセンブリ言語を実行します。

ばねロボットは確かに人工重力と巨大な穴の場所を踏破できますが、欠点がひとつあります：
記憶できるバネスクリプト命令は最大**15**個までです。

ばねロボットは自動的に前進し、**跳び上がるどうか**を常に考えます。
バネスクリプトプログラムはこの決断のロジックを定義します。

バネスクリプトプログラムは[真理値](https://ja.wikipedia.org/wiki/%E3%83%96%E3%83%BC%E3%83%AA%E3%82%A2%E3%83%B3%E5%9E%8B)
のみを扱い、数値や文字列は使えません。
**一時**レジスタ`T`と**ジャンプ**レジスタ`J`のふたつのレジスタを使用できます。
バネスクリプトプログラムの終了時にジャンプレジスタが**真**の場合、ばねロボットは跳び上がろうとします。
これらのレジスタは両方とも初期値は**偽**です。

ばねロボットには、向いている方向のさまざまな距離に
**地面があるかどうか**を検出できるセンサーがあります。
これらの値は**読み取り専用レジスタ**で提供されます。
ばねロボットは、1タイル離れた(`A`)、2タイル離れた(`B`)、3タイル離れた(`C`)、4タイル離れた(`D`)の
4つの距離で地面を検出できます。
指定された距離に地面がある場合レジスタは**真**になります。
穴がある場合レジスタは偽になります。

**3つの命令**だけがバネスクリプトで利用でます。

- `AND X Y` は`X`と`Y`の両方が真の場合`Y`に真を設定します。
それ以外の場合は`Y`に偽を設定します。
- `OR X Y` は`X`またはが`Y`の少なくとも一つが`真`の場合`Y`に真を設定します。
それ以外の場合は`Y`に偽を設定します。
- `NOT X Y` は`X`が偽の場合`Y`に真を設定します。
それ以外の場合は`Y`に偽を設定します。

3つの命令すべてで、第2引数(`Y`)は**書き込み可能なレジスタ**（`T`または`J`）である必要があります。
第1引数(`X`)は（`A`, `B`, `C`, `D`を含む）**任意のレジスタ**にできます。

たとえば、1命令プログラム`NOT A J`は
「目の前のタイルが地面でないならば跳び上がる」という意味です。

または、3タイル幅の穴（穴の向こう側に地面がある）が検出された場合に飛び上がるプログラムを次に示します。

```
NOT A J
NOT B T
AND T J
NOT C T
AND T J
AND D J
```

IntcodeプログラムはASCII入力および出力を想定しています。
プロンプトを表示することから始めます。
次に、1行に1つずつ目的の命令を入力してください。
各行は改行（ASCIIコード10）で終了します。
**プログラムの入力が終了したら**、
コマンド`WALK`に続いて改行を入力することで、
ばねロボットに船体の調査を開始するよう指示します。

ばねロボット**が宇宙空間に落ちた**場合、
その最後の光景のASCIIレンダリングが生成されます。
これらにおいて`@`はばねロボット、`#`は船体、`.`は何もない空間を表します。
たとえば、次のようにばねロボットをプログラムするとします。

```
NOT D J
WALK
```

この1命令プログラムは4タイル離れた先に地面が場合にのみ`J`を真に設定します。
言い換えれば、見つけた穴に飛び込もうとします。

```
.................
.................
@................
#####.###########

.................
.................
.@...............
#####.###########

.................
..@..............
.................
#####.###########

...@.............
.................
.................
#####.###########

.................
....@............
.................
#####.###########

.................
.................
.....@...........
#####.###########

.................
.................
.................
#####@###########
```

しかしながら、ばねロボットが破損区域の踏破に成功した場合、
出力命令を使用して、
通常のASCII範囲外の単一の巨大整数として**船体の損傷量**を示します。

ばねロボットをロジックでプログラムして、宇宙空間に落ちることなく船体を調査できるようにしてください。
**ばねロボットが報告する船体の損傷量はいくつですか？**

# パート2 #

ばねロボットが到達できない多くの領域があります。
マニュアルをめくって、**センサーの範囲を広げる方法**を見つけます。

バネスクリプトプログラムを`WALK`で終わる代わりに`RUN`を使用します。
これにより最大**9タイル離れた**地面を検知できる**拡張センサーモード**が有効になります。
このデータは、**5つの新しい読み取り専用レジスタ**で利用できます。

- レジスタ`E`は*5*タイル離れたところに地面があるかどうかを示します。
- レジスタ`F`は*6*タイル離れたところに地面があるかどうかを示します。
- レジスタ`G`は*7*タイル離れたところに地面があるかどうかを示します。
- レジスタ`H`は*8*タイル離れたところに地面があるかどうかを示します。
- レジスタ`I`は*9*タイル離れたところに地面があるかどうかを示します。

他のすべての機能は同じままです。

`RUN`でプログラムを終端して、船体の残りの部分の調査を成功させてください。
**今回ばねロボットが報告する船体の損傷量はいくつですか？**
