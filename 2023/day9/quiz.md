# 9日目：蜃気楼の保全

砂嵐の中をラクダに乗って、幽霊の地図が停止するように指示した場所で停止します。
その後砂嵐は静まり、どういうわけかあなたは**オアシス**にたどり着いていました。

ラクダが水を飲みもうとして、あなたは首を伸ばします。
見上げると、さらに別の巨大な浮島に違いないものを発見しました。これは金属でできています。
**砂の機械を修理する部品**もそこから来ているのでしょう。

ここには半ば砂に埋もれたハンググライダーもあります。
太陽が昇って砂が温まれば、グライダーと熱風を使って金属の島まで到達できるかもしれません。

日が昇るのを待ちながら、砂之島の真ん中に隠されたオアシスを眺めます。
繊細な生態系を持っているに違いありません。
待っている間に生態学の本を読んでみるのもいいかもしれません。(?take readings生態系について観察してみる?)
環境の不安定さを見つけたら誰かに報告して、砂嵐に疲れた次の旅行者がオアシスを利用できるようにすることもできます。

あなたは携帯型の**オアシスと砂の不安定性センサー** (Oasis And Sand Instability Sensor, OASIS) を取り出して、周囲を分析します。
OASIS は、多くの値と、それらが時間の経過とともにどのように変化するかのレポート（あなたのパズル入力）を作成します。
レポートの各行には、単一の値の**履歴**が含まれます。例えば：

```
0 3 6 9 12 15
1 3 6 10 15 21
10 13 16 21 30 45
```

オアシスを最大限に保護するには、環境レポートに各履歴に**次の値の予測**を含める必要があります。
これを行うには、履歴の**各ステップの差**から新しい数列を作成することから始めます。
その数列が「全て零」**ではない**場合は、今生成した数列を入力として、このプロセスを繰り返します。
最新の数列内の全ての値が零になると、元の履歴の次の値が何になるかを推定できます。

上記のデータセットでは、最初の履歴は `0 3 6 9 12 15` です。
値はステップごとに3ずつ増加しているため、最初に生成される一連の差分は `3 3 3 3 3` になります。
各ステップで入力から2つの数値を考慮するため、この数列の値は入力列より1つ少ないことに注意してください。
これらの値は全て零ではないため、このプロセスを繰り返します。
各ステップで値が0異なるため、次の数列は `0 0 0 0` になります。
これは、履歴を外挿するのに十分な情報があることを意味します！
視覚的には、これらの数列は次のように配置できます：

```
0   3   6   9  12  15
  3   3   3   3   3
    0   0   0   0
```

外挿するには、零のリストの末尾に新たに零を追加することから始めます。
零はその上の2つの値の差を表すため、これはその上の全ての数列に空欄があることも意味します。

```
0   3   6   9  12  15   [B]
  3   3   3   3   3   [A]
    0   0   0   0   (0)
```

その後、空欄を下から上へ埋めていきます。
`[A]` は（その左の値）3を（その下の値）0だけ増加させた結果である必要があります。
これは`[A]`が3であることを意味します。：

```
0   3   6   9  12  15   [B]
  3   3   3   3   3   (3)
    0   0   0   0   (0)
```

最後に、空欄`[B]`を埋めることができます。
それは（その左の値）15を（その下の値）3だけ増加させた結果である必要があります。
つまり18です：

```
0   3   6   9  12  15  (18)
  3   3   3   3   3   (3)
    0   0   0   0   (0)
```

したがって、最初の履歴の次の値は**18**です。

2番目の履歴の全て零な差を見つけるには、追加の数列が必要です：

```
1   3   6  10  15  21
  2   3   4   5   6
    1   1   1   1
      0   0   0
```

次に、前と同じプロセスに従って、各数列の次の値を下から上に計算します：

```
1   3   6  10  15  21  (28)
  2   3   4   5   6   (7)
    1   1   1   1   (1)
      0   0   0   (0)
```

したがって、2番目の履歴の次の値は**28**です。

3番目の履歴にはさらに多くの数列が必要ですが、次の値は同じ方法で見つけることができます：

```
10  13  16  21  30  45  (68)
   3   3   5   9  15  (23)
     0   2   4   6   (8)
       2   2   2   (2)
         0   0   (0)
```

したがって、3番目の履歴の次の値は**68**です。

この例で各履歴の次の値を求めてそれらを足し合わせると**114**が得られます。

OASISレポートを分析し、各履歴の次の値を外挿します。
**これらの外挿値の合計はいくらですか？**

# パート2

もちろん、レポートに**さらに多くの履歴**を含めることは素晴らしいことです。
確かに、**後ろ向きに推定**することも安全ですよね？

履歴ごとに、差の数列が全体で零になるまで、差を求めるプロセスを繰り返します。
次に、末尾に零を追加して、手前の各数列の次の値を埋める代わりに、零の数列の**先頭**に零を追加してから、手前の各数列の新しい**初項**を埋めます。

具体的に、過去に遡って推定した場合の3番目の履歴の例は次のようになります：

```
(5)  10  13  16  21  30  45
  (5)   3   3   5   9  15
   (-2)   0   2   4   6
      (2)   2   2   2
        (0)   0   0
```

各数列の左側に新しい値を下から上に追加すると、最終的に新しい左端の履歴の値5が明らかになります。

上記の残りのサンプルデータに対してこれを実行すると、最初の履歴と2番目の履歴の以前の値はそれぞれ-3, 0となります。
3つの新しい値をすべて足し合わせると**2**となります。

OASISレポートを再度分析し、今回は各履歴の**以前の**値を推定します。
**これらの外挿値の合計はいくらですか？**
