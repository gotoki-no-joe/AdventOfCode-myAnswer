# 19日目: たっぷり

歯車島の妖精はあなたの助けに感謝し、あなたを送り届けます。
彼らは、誰かが砂之島から[盗んだ](../day9/quiz.md)ハンググライダーさえ持っています。
あなたはすでにその方向に進んでいるのですから、それを使ってそこに降りて彼らに返してくれれば、
彼らは大いに助けになるでしょう。

**機械部品の容赦ない雪崩の底**に到達すると、既に手に負えないほどの山積みをなしていることがわかります。
けれど心配いりません。
妖精の一団が既にここで部品を整理しており、**システム**を持っています。

まず、各部品は次の4つのカテゴリごとに評価されています：

- `x`：E**x**tremely cool looking 非常にクールな見た目
- `m`：**M**usical 音のよさ（叩くと音が鳴ります）
- `a`：**A**erodynamic 空力学的特性
- `s`: **S**hiny 光沢

そして、各部品は一連の**ワークフロー**へ送り込まれ、最終的に**採用** (accept) か**廃棄** (reject) かが決められます。
それぞれのワークフローには名前があり、**規則**のリストからなります。
ひとつの規則は、条件と、条件が満たされている場合に部品を送り出す場所を指定します。
今考えている部品が適合するリストの最初の規則が直ちに適用され、
その部品は規則で述べられている宛先に移動します。
（各ワークフローの最後の規則には条件がなく、到達すると常に適用されます。）

ワークフロー `ex{x>10:one,m<20:two,a>30:R,A}` を考えてみます。
このワークフローは `ex` という名前で、4つの規則が含まれています。
ワークフロー `ex` がある特定の部品を検討している場合、次の手順を順に実行します：

- 規則 `x>10:one`：部品の `x` が 10 を超えているならば、その部品を `one` という名前のワークフローに送ります。
- 規則 `m<20:two`：さもなくば、部品の `m` が 20 より小さければ、その部品を `two` という名前のワークフローに送ります。
- 規則 `a>30:R`：さもなくば、部品の `a` が 30 を超えている場合、パーツは直ちに**廃棄** (`R`) されます。
- 規則 `A`： さもなくば、この部品が適合する規則がもう存在しないため、部品は直ちに**採用** (`A`) されます。

部品が別のワークフローに送られると、すぐにそのワークフローの先頭に切り替わり、戻ることはありません。
部品が**採用**（`A`に送られる）または**廃棄**（`R` に送られる）されたならば、
部品はそれ以降の処理を直ちに停止します。

システムは稼働していますが、奇妙な金属の形状の奔流に追いついていません。
妖精たちは、いくつかの部品を分類するのを手伝ってくれないかと尋ね、
ワークフローといくつかの部品の評価のリスト（あなたのパズル入力）を渡してきました。
例えば：

```
px{a<2006:qkq,m>2090:A,rfg}
pv{a>1716:R,A}
lnx{m>1548:A,A}
rfg{s<537:gd,x>2440:R,A}
qs{s>3448:A,lnx}
qkq{x<1416:A,crn}
crn{x>2662:A,R}
in{s<1351:px,qqz}
qqz{s>2770:qs,m<1801:hdj,R}
gd{a>3333:R,R}
hdj{m>838:A,pv}

{x=787,m=2655,a=1222,s=2876}
{x=1679,m=44,a=2067,s=496}
{x=2036,m=264,a=79,s=2244}
{x=2461,m=1339,a=466,s=291}
{x=2127,m=1623,a=2188,s=1013}
```

最初にワークフローがリストされ、その後に空白行が続き、
その後に妖精が分類を希望している部品の評価がリストされます。
全ての部品は、`in` という名前のワークフローから始めます。
この例では、リストされた5つの部品が次のワークフローを通過します。

- `{x=787,m=2655,a=1222,s=2876}` : `in` → `qqz` → `qs` → `lnx` → `A`
- `{x=1679,m=44,a=2067,s=496}` : `in` → `px` → `rfg` → `gd` → `R`
- `{x=2036,m=264,a=79,s=2244}` : `in` → `qqz` → `hdj` → `pv` → `A`
- `{x=2461,m=1339,a=466,s=291}` : `in` → `px` → `qkq` → `crn` → `R`
- `{x=2127,m=1623,a=2188,s=1013}` : `in` → `px` → `rfg` → `A`

最終的に、3つの部品**採用**になります。
採用された各部品の `x`, `m`,  `a`, `s` の評価を合計すると、
`x=787` の部品は 7540、 `x=2036` の部品は 4623、`x=2127` の部品は 6951 となります。
**全て**の採用された部品の全ての評価を合計すると、総計 **19114** が得られます。

与えられた全ての部品を分類します。
**最終的に採用された全ての部品の評価を全て合計するといくつになりますか？**

# パート2

あなたの協力があっても、分類処理は**まだ**速度が足りません。

妖精の1人が新しい計画を思いつきます。
個々の部品をこれら全てのワークフローで分類するのではなく、
どの評価の組み合わせが採用されるか廃棄されるかを事前に把握できるかもしれません。

4つの評価 (`x`, `m`, `a`, `s`) のそれぞれは、最小値1から最大値4000までの範囲の整数値をとります。
評価の**考えられる全ての組み合わせ**について、どれが**採用**されるかを判断するのがあなたの仕事です。 .

上記の例では、受け入れられる評価の異なる組み合わせは**167409079868000**通りあります。

ワークフローのリストのみを考えてください。
妖精があなたに分類してほしいと望んでいた部品評価のリストは、もはや意味がありません。
**妖精のワークフローにより採用される、異なる評価の組み合わせはいくつありますか？**
