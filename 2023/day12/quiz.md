# 12日目：温泉

ついに温泉に到着しました！
華やかな建物に隣接する奥まったエリアから蒸気が立ち上っているのが見えます。

入ろうと背を向けると、研究者に呼び止められました。
「待って、hot springsを探しているのではなかったの？」
あなたは、これは間違いなく温泉のように見えると言いました。

「あ、ごめんなさい、ありがちな間違いです！ ここは確かに温泉です！ Hot springsは隣にあります。」

研究者が指している方向を見ると突然、頭上にそびえ立つ巨大な金属の螺旋に気づきます。「こちらです！」

あと数歩歩くだけで、スプリングのある広大な柵で囲まれたエリアの正門に到着します。
門をくぐると小さな管理棟に入ります。

「こんにちは！ 今日は何をしにhot springsに来たんですか？
申し訳ありませんが、今はあまり熱くありません。現在、**溶岩が不足**しています。」
あなたは、砂之島で不足している機械部品について尋ねます。

「ああ、歯車島は現在すべてオフラインです！現時点では何も製造されていません。
鍛冶場を加熱するための溶岩がさらに入手できるまでは製造されません。
そしてスプリングも。スプリングは熱くなければあまり弾性がありません！」

「ねえ、上に行って、なぜ溶岩の流れが止まったのか見てもらえませんか？
スプリングは通常の動作には冷たすぎますが、
**あなた**をそこまで打ち上げるのに十分な弾力のあるスプリングを見つけることができるはずです！」

問題がひとつだけあります。多くのスプリングが破損しており、
どのスプリングが**安全に**使用できるのかさえ実際にはわかりません！
さらに悪いことに、**どのスプリングが損傷しているかの状態の記録**（あなたのパズル入力）も破損しています。
破損した記録を修復するのを手伝う必要があります。

すぐ外に広がる広大な原野には、スプリングが**列をなして**並んでいます。
それぞれの列について、状態の記録は個々のスプリングが**正常** (`.`) か**故障** (`#`) かを示しています。
ただしこの欄は、状態記録そのものが損傷している可能性のある部分です。
一部のスプリングでは、スプリングが正常なのか故障なのか**不明** (`?`)です。

ただし、状態記録を作成したエンジニアは、この情報の一部を別の形式で複製しました。
ある列のスプリングのリストの後に、**故障したスプリングの連続するグループ**のサイズが、
それらのグループが列に現れる順でリストされています。
このリストには必ず、故障している全てのスプリングが含まれており、
各数値はその連続するグループの全体のサイズです
（つまり、グループは常に少なくとも1つの正常なスプリングによって分離されます。
`####` は必ず `4` になり、 `2,2` となることはありません。）

したがって、不明なスプリング状態を含まない状態記録は次のようになります：

```
#.#.### 1,1,3
.#...#....###. 1,1,3
.#.###.#.###### 1,3,1,6
####.#...#... 4,1,1
#....######..#####. 1,6,5
.###.##....# 3,2,1
```

しかし、状態記録は部分的に破損しています。
いくつかのスプリングの状態は実際には**不明** (`?`)です。例えば：

```
???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1
```

この情報を活用して、それぞれの列について、与えられた記録に適合するような、
正常なスプリングと故障したスプリングの**異なる配置がいくつあるか**を把握することがあなたの仕事です。

最初の行 (`???.### 1,1,3`) では、その列に壊れたスプリングの分離したグループが1つ、1つ、3つと
この順序で出現するやり方はちょうど**一通り**だけです。
最初の3つの不明なスプリングは順に故障、正常、故障で (`#.#`) 列全体は `#.#.###` となります。

2行目はより興味深いです：`.??..??...?##. 1,1,3` は全部で**4つ**の異なる配置が考えられます。
（最後の連続グループである3つの故障スプリングに応じて）最後の`?`は必ず故障とわかります。
そしてそれぞれの `??` は2つの故障スプリンググループのうちちょうど一つずつを隠す必要があります。
（`??`は二つとも故障にはなりません。そうなると、2つからなる連続グループをひとつ形成することになります。(?超訳...)
そのとき、後半の数値列は `2,3` とならなければなりません。）
それぞれの `??` は `#.` または `.#` となるため、スプリングの可能な配置は4つあります。

最後の行は、実際のところ**10**の異なる配置と矛盾なく整合します！
最初の数値は3であるため3、最初と2番目の`?`は両方とも`.`である必要があります。
（もしどちらかが`#`ならば、最初の数値は4またはそれ以上になります。）
しかし、不明なスプリング状態の残りの並びについては、
故障スプリングの2つと1つのグループを持つ多くの様々な方法があります。

```
?###???????? 3,2,1
.###.##.#...
.###.##..#..
.###.##...#.
.###.##....#
.###..##.#..
.###..##..#.
.###..##...#
.###...##.#.
.###...##..#
.###....##.#
```

この例では、各列で可能な配置の数は次のとおりです：

- `???.### 1,1,3` 1
- `.??..??...?##. 1,1,3` 4
- `?#?#?#?#?#?#?#? 1,3,1,6` 1
- `????.#...#... 4,1,1` 1
- `????.######..#####. 1,6,5` 4
- `?###???????? 3,2,1` 10

可能な配置の個数をすべて加算すると、配置の合計は**21**となります。

各列について、指定された基準を満たす、正常なスプリングと故障中のスプリングの異なる配置を全て数えます。
**それらの数の合計はいくらですか？**

# パート2

スプリングの広野を見渡すと、状況記録リストよりもはるかに多くのスプリングがあるように感じます。
記録を調べてみると、実際にはずっと**折りたたまれていた**ことがわかります。

**畳まれた記録を広げる**には、それぞれの列について、
スプリング状態のリストをそれ自体の5つのコピー（`?`で区切る）に置き換え、
故障スプリングの連続グループのリストもそれ自体の5つのコピー（`,`で区切る）に置き換えます。

したがって、この行は：

```
.# 1
```

こうなります：

```
.#?.#?.#?.#?.# 1,1,1,1,1
```

上記の例の最初の行は次のようになります。

```
???.###????.###????.###????.###????.### 1,1,3,1,1,3,1,1,3,1,1,3,1,1,3
```

上の例では、展開後、一部の列では可能な配置の数が大幅に増加しています：

- `???.### 1,1,3` 1
- `.??..??...?##. 1,1,3` 16384
- `?#?#?#?#?#?#?#? 1,3,1,6` 1
- `????.#...#... 4,1,1` 16
- `????.######..#####. 1,6,5` 2500
- `?###???????? 3,2,1` 506250

展開後、可能な配置数をすべて加算すると、**525152**が得られます。

状態の記録を展開します。**可能な配置数の新しい合計はいくらですか？**
