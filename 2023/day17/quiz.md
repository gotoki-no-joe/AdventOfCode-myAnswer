# 17日目: 不器用な「るつぼ」

溶岩製造施設が稼働を始めると、溶岩が急速に流れ始めます。
あなたが立ち去ろうとすると、トナカイがパラシュートを提供してくれたので、すぐに歯車島に到着できます。
(?音を重視して「ギア之島」とするのとどちらがいいかしら)

降下していく間に歯車島の全貌が見渡せます。
それでなぜ登りでは人を見つけるのに苦労したのかがわかります。
歯車島の半分は無人ですが、眼下にあるもう半分は巨大な工場都市です！

あなたは、新しい**溶岩の滝**の滝底にある、徐々に満たされていく溶岩プールの近くに着陸します。
最終的に溶岩は溶岩ダクトによって街中に運ばれることになりますが、すぐに利用できるよう、
妖精たちは車輪の付いた大きな「るつぼ」に溶岩を積み込んでいます。

るつぼは上部が重いので手で押します。(? 因果があるかどうかわからない)
残念ながら、るつぼは高速では舵取りが非常に難しくなるため、非常に長い間真っ直ぐ進むことが困難になる場合があります。

砂之島に必要な機械の部品をできるだけ早く入手するには、
るつぼを**溶岩プールから機械部品工場まで**運ぶ最良の方法を見つける必要があります。
これを行うには、**熱損失**を最小限に抑えながら、
るつぼを長すぎる**直線区間**に入れずに済む経路を選択する必要があります

幸いなことに、ここの妖精は、交通パターン、周囲温度、その他数百のパラメータを使用して、
任意の都市の区画について、るつぼがそこに入るときにどの程度の熱損失が予想されるかを
正確に計算する地図（あなたのパズル入力）を持っています。

例えば：

```
2413432311323
3215453535623
3255245654254
3446585845452
4546657867536
1438598798454
4457876987766
3637877979653
4654967986887
4564679986453
1224686865563
2546548887735
4322674655533
```

各都市区画には、**るつぼがその区画に入った場合の熱損失量**を表す1桁の数字が記されています。
出発点である溶岩プールは、左上の区画です。
目的地である機械部品工場は右下の区画です。
（開始時点で既に左上の区画にいるため、その区画を離れてまた戻らない限り、この区画の熱損失は発生しません。）

上が重いるつぼを長時間真っ直ぐに動かし続けるのは難しいため、
一つの方向には**最大3区画**までしか移動できず、その後は左または右に直角に曲がらなくてはなりません。
るつぼは反対方向に引き返すこともできません。
各都市区画に入った後は、左折、直進、右折のみが可能です。

熱損失を最小限に抑える方法の1つは、次の経路です：

```
2>>34^>>>1323
32v>>>35v5623
32552456v>>54
3446585845v52
4546657867v>6
14385987984v4
44578769877v6
36378779796v>
465496798688v
456467998645v
12246868655<v
25465488877v5
43226746555v>
```

この経路は、連続して3区画を超えて同じ方向に移動することはなく、熱損失は**102**だけです。

るつぼを溶岩プールから機械部品工場に向けます。
ただし、連続する区画を3つ以上同じ方向に移動させないで、
**発生する熱損失の最小値はどれだけですか？**

# パート2

溶岩のるつぼは、機械部品工場に溶岩を十分に供給できるほど大きくありません。
代わりに、妖精は**ウルトラるつぼ**にアップグレードする予定です。

ウルトラるつぼは通常のるつぼよりも操縦がさらに困難です。
直進するのが難しいだけでなく、曲がるのも難しいのです。

ウルトラるつぼがある方向に動き始めたら、向きを変える前に（あるいは最後に停止する前にも）
その方向に少なくとも4区画移動する必要があります。
しかし、最終的にはぐらつき始めます。
ウルトラるつぼは、向きを変えずに最大で**連続10区画**移動できます。

上の例では、ウルトラるつぼは次の経路をたどって熱損失を最小限に抑えることができます。

```
2>>>>>>>>1323
32154535v5623
32552456v4254
34465858v5452
45466578v>>>>
143859879845v
445787698776v
363787797965v
465496798688v
456467998645v
122468686556v
254654888773v
432267465553v
```

上記の例では、ウルトラるつぼの熱損失は最小値**94**に抑えられます。

別の例を次に示します。

```
111111111111
999999999991
999999999991
999999999991
999999999991
```

悲しいことに、ウルトラるつぼは次のような不幸な道を歩まなければなりません。

```
1>>>>>>>1111
9999999v9991
9999999v9991
9999999v9991
9999999v>>>>
```

この経路により、ウルトラるつぼの熱損失は最小値**71**に抑えられます。

**ウルトラるつぼ**を溶岩プールから機械部品工場に導くとき、
**発生する最小限に必要な熱損失はどれだけですか？**
